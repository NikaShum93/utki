<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî Utki</title>

  <style>
    :root{
      --ui-acc:#ffd700;
      --bg:#0d0d0d;
      --card:#151515;
      --ink:#eee;
      --muted:#b7b7b7;
      --stroke:#2a2a2a;
      --gap:16px;

      --field:#101010;
      --field-stroke:#3a3a3a;
      --glow: rgba(255,215,0,.16);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; flex-direction:column;
    }

    header{
      display:flex; align-items:center; gap:12px;
      padding:16px 20px;
      border-bottom:1px solid var(--stroke);
      position:sticky; top:0; background:var(--bg); z-index:3;
    }
    header h1{
      font-size:20px; margin:0; color:var(--ui-acc); font-weight:900;
      letter-spacing:.2px;
    }

    main{
      display:grid; grid-template-columns: 520px 1fr;
      gap:22px; padding:20px; max-width:1500px; width:100%; margin:0 auto;
      align-items:start;
    }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:18px;
      box-shadow:0 0 28px rgba(255,215,0,.06);
      overflow:hidden;
    }
    .card h2{
      margin:0 0 14px; font-size:18px; color:var(--ui-acc); font-weight:900;
      padding-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }

    label{
      display:block; margin:12px 0 8px; font-size:15px; color:#fff; font-weight:700;
      line-height:1.25;
    }
    input[type=text], input[type=number], input[type=url], textarea, select{
      width:100%;
      background:var(--field);
      color:#fff;
      border:1px solid var(--field-stroke);
      border-radius:10px;
      padding:10px 12px;
      font-size:15px;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease, transform .15s ease;
    }
    textarea{min-height:90px; resize:vertical}
    input:focus, textarea:focus, select:focus{
      border-color:#4b4b4b; box-shadow:0 0 0 3px var(--glow);
    }
    select{cursor:pointer}
    input[type="checkbox"]{transform: translateY(1px);}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .result{
      display:grid; grid-template-columns:1fr auto; gap:12px; align-items:start;
    }
    .result textarea{
      height:130px;
      font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:13px;
    }
    .hint{color:var(--muted); font-size:13px; margin-top:6px}
    .small-hint{font-size:12px; color:var(--muted); margin-top:2px; line-height:1.35}

    button{
      background:linear-gradient(90deg,#ffbf00,#ffd700);
      color:#000;
      border:none;
      border-radius:12px;
      font-weight:900;
      padding:12px 16px;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease;
      font-size:15px;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    button:hover{transform:translateY(-1px); box-shadow:0 8px 26px rgba(255,215,0,.28)}
    .btn-ghost{
      background:transparent;
      color:#fff;
      border:1px solid #444;
      font-weight:800;
    }
    .btn-ghost:hover{
      box-shadow:0 8px 26px rgba(255,255,255,.08);
      transform:translateY(-1px);
    }

    .divider{
      height:1px; background:rgba(255,255,255,.06); margin:14px 0;
    }

    /* --------- Sections (details) --------- */
    details.section{
      border:1px solid rgba(255,255,255,.06);
      border-radius:14px;
      background:rgba(0,0,0,.12);
      padding:10px 12px;
      margin:12px 0;
    }
    details.section[open]{
      border-color:rgba(255,215,0,.22);
      box-shadow:0 0 0 3px rgba(255,215,0,.06), 0 0 18px rgba(255,215,0,.08);
      background:rgba(0,0,0,.18);
    }
    summary.section-title{
      list-style:none;
      cursor:pointer;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:8px 6px;
      font-weight:900;
      color:var(--ui-acc);
      user-select:none;
    }
    summary.section-title::-webkit-details-marker{display:none}
    .section-left{
      display:flex; align-items:center; gap:10px;
      font-size:16px;
    }
    .chev{
      width:10px; height:10px; border-right:2px solid rgba(255,215,0,.8);
      border-bottom:2px solid rgba(255,215,0,.8);
      transform:rotate(45deg);
      transition:transform .15s ease;
      opacity:.9;
      margin-left:4px;
    }
    details[open] .chev{ transform:rotate(225deg); }
    .badge{
      font-size:12px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.86);
      background:rgba(255,255,255,.04);
      font-weight:800;
    }
    .badge.on{
      border-color:rgba(255,215,0,.35);
      color:#111;
      background:linear-gradient(90deg,#ffbf00,#ffd700);
    }
    .section-body{ padding:6px 2px 2px; }

    /* --------- Preview --------- */
    .preview-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
    }
    .hud{
      display:flex; align-items:center; gap:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.18);
    }
    #iconPrev{
      width:36px; height:36px;
      background:#222; border-radius:10px;
      background-size:contain; background-position:center; background-repeat:no-repeat;
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 0 18px rgba(255,215,0,.06);
    }
    #textPrev{font-weight:900; font-size:22px;}

    .preview-panels{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }
    @media (max-width: 1100px){
      main{grid-template-columns:1fr}
      .preview-panels{grid-template-columns:1fr}
    }

    .preview-card{
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      padding:12px;
      overflow:hidden;
    }
    .preview-card .cap{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .preview-card .cap b{
      color:var(--ui-acc); font-weight:900; letter-spacing:.2px;
    }

    /* Simulated modal box */
    #taskPreviewBox{
      border-radius:18px;
      padding:14px 14px 12px;
      border:2px solid transparent;
      color:#fff;
      background:linear-gradient(135deg, #4facfe, #00f2fe);
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      transform-origin:center;
    }
    #taskPreviewQuestion{
      font-weight:900;
      margin-bottom:10px;
      line-height:1.25;
    }
    .mini-zone{
      display:flex; align-items:center; justify-content:center;
      gap:8px;
      padding:10px;
      border-radius:14px;
      min-height:42px;
      font-size:12px;
      color:rgba(255,255,255,.85);
      border:1px dashed rgba(255,255,255,.14);
    }

    #feedbackPreviewBox{
      border-radius:16px;
      padding:12px 14px;
      border:2px solid transparent;
      color:#fff;
      background:#131316;
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      transform-origin:center;
    }
    #feedbackPreviewText{
      font-weight:900;
      font-size:22px;
      line-height:1.2;
      text-align:center;
    }

    .summary{
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      padding:12px;
      display:grid;
      gap:6px;
      color:rgba(255,255,255,.86);
      font-size:13px;
    }
    .summary span{
      color:rgba(255,255,255,.92);
      font-weight:800;
    }

    .pub-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      margin-top:10px;
    }
  </style>

  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap">
</head>

<body>
  <header><h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´Utki¬ª</h1></header>

  <main>
    <!-- LEFT -->
    <section class="card">
      <h2>‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>

      <!-- Quick settings always visible -->
      <div class="row">
        <div>
          <label>–Ø–∑—ã–∫</label>
          <select id="language"></select>
        </div>
        <div>
          <label>–®—Ä–∏—Ñ—Ç</label>
          <select id="font"></select>
        </div>
      </div>

      <!-- CONTENT -->
      <details class="section" open>
        <summary class="section-title">
          <div class="section-left">üß© –ö–æ–Ω—Ç–µ–Ω—Ç <i class="chev"></i></div>
          <div class="badge" id="badgeTasks">0 –∑–∞–¥–∞–Ω–∏–π</div>
        </summary>
        <div class="section-body">

          <label>–í–æ–ø—Ä–æ—Å—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
          <textarea id="questions" placeholder="–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2+2?&#10;–ù–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–∏–µ x –≤ —É—Ä–∞–≤–Ω–µ–Ω–∏–∏ ..."></textarea>
          <div class="small-hint">1 —Å—Ç—Ä–æ–∫–∞ = 1 –∑–∞–¥–∞–Ω–∏–µ. –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–æ—Ä–º—É–ª—ã (MathJax) –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏.</div>

          <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞–±–æ—Ä—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
          <textarea id="correctAnswers" placeholder="4|—á–µ—Ç—ã—Ä–µ&#10;x=3|3"></textarea>
          <div class="small-hint">–í–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ <b>|</b>. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –±–µ–∑ –æ—Ç–≤–µ—Ç–∞.</div>

          <label>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞–±–æ—Ä—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
          <textarea id="wrongAnswers" placeholder="3|5&#10;x=1|1"></textarea>
          <div class="small-hint">–í–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ <b>|</b>. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º.</div>

          <div class="divider"></div>

          <label style="margin-top:10px;">
            <input type="checkbox" id="autoDistractors">
            –ë—Ä–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
          </label>
          <div class="small-hint">
            –ï—Å–ª–∏ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã wrong-–≤–∞—Ä–∏–∞–Ω—Ç—ã, –ø–ª–∞–≥–∏–Ω –ø–æ–¥–º–µ—à–∞–µ—Ç distractors –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.
          </div>

          <div class="row" style="margin-top:12px">
            <div style="display:flex; flex-direction:column; gap:6px;">
              <label style="margin:0;">
                <input type="checkbox" id="quizUseOtherCorrect">
                –í –∫–≤–∏–∑–µ –¥–æ–±–∏—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç wrong)
              </label>
              <div class="small-hint">
                –ï—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–µ–Ω—å—à–µ 2 ‚Äî –±—É–¥–µ—Ç —Ä–µ–∂–∏–º ¬´–≤–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç¬ª.
              </div>
            </div>

            <div>
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ –∫–≤–∏–∑–µ</label>
              <select id="quizMaxOptions">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
              </select>
              <div class="small-hint">–†–µ–∫–æ–º–µ–Ω–¥—É—é 4. –ï—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ.</div>
            </div>
          </div>

        </div>
      </details>

      <!-- MODES -->
      <details class="section" open>
        <summary class="section-title">
          <div class="section-left">üß† –†–µ–∂–∏–º—ã <i class="chev"></i></div>
          <div class="badge" id="badgeModes">‚Äî</div>
        </summary>
        <div class="section-body">

          <label style="margin:0;">
            <input type="checkbox" id="orderMode">
            –†–µ–∂–∏–º: —Å–æ–±—Ä–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑ —Å–ª–æ–≤ (–¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤)
          </label>
          <div class="small-hint" style="margin-top:6px;">
            –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ ‚Äî –ª—é–±–æ–µ –∑–∞–¥–∞–Ω–∏–µ –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤/–æ—Ç–≤–µ—Ç–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –∫–∞–∫ ¬´—Ä–∞—Å—Å—Ç–∞–≤—å —Å–ª–æ–≤–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É¬ª.
          </div>

          <div class="divider"></div>

          <label style="margin:0;">
            <input type="checkbox" id="feedbackEnabled" checked>
            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫ (—Å—É–Ω–¥—É–∫/–∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏ —Ç–µ–∫—Å—Ç)
          </label>
        </div>
      </details>

      <!-- VISUAL -->
      <details class="section" open>
        <summary class="section-title">
          <div class="section-left">üé® –í–∏–∑—É–∞–ª <i class="chev"></i></div>
          <div class="badge" id="badgeNeon">NEON</div>
        </summary>
        <div class="section-body">

          <div class="row">
            <div>
              <label>–†–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤</label>
              <select id="uiScale">
                <option value="0.85">S (–∫–æ–º–ø–∞–∫—Ç–Ω–æ)</option>
                <option value="1" selected>M (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                <option value="1.15">L (–∫—Ä—É–ø–Ω–æ)</option>
              </select>
              <div class="small-hint">–í–ª–∏—è–µ—Ç –Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –ø—Ä–µ–≤—å—é –∏ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–¥–∞–Ω–∏—è.</div>
            </div>
            <div>
              <label>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
              <input type="text" id="finalFeedback" placeholder="üéâ Well Done!">
            </div>
          </div>

          <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ –ª–µ—Ç–∞—é—â–µ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ (URL)</label>
          <input type="url" id="bgImage" placeholder="https://.../duck.gif">

          <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Ñ–∏–¥–±–µ–∫–∞ (URL)</label>
          <input type="url" id="feedbackImage" placeholder="https://.../chest.png">

          <div class="divider"></div>

          <h2 style="margin:0 0 12px; border:0; padding:0; font-size:16px;">ü™ü –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>

          <div class="row">
            <div>
              <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
              <input type="color" id="taskBgColor" value="#4facfe">
            </div>
            <div>
              <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
              <input type="color" id="taskBorderColor" value="#00f2fe">
            </div>
          </div>

          <div class="row">
            <div>
              <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
              <input type="color" id="taskTextColor" value="#ffffff">
            </div>
            <div>
              <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0‚Äì1)</label>
              <input type="number" id="taskBgOpacity" value="1" step="0.1" min="0" max="1">
            </div>
          </div>

          <div class="row">
            <div>
              <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</label>
              <input type="number" id="taskFontSize" value="22" min="10" max="60">
              <div class="small-hint">–° —É—á—ë—Ç–æ–º ‚Äú–†–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤‚Äù –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º.</div>
            </div>
            <div style="display:flex; align-items:flex-end;">
              <label style="margin:0;">
                <input type="checkbox" id="taskNeon" checked> –ù–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ –∑–∞–¥–∞–Ω–∏—è
              </label>
            </div>
          </div>

          <div class="divider"></div>

          <h2 style="margin:0 0 12px; border:0; padding:0; font-size:16px;">üí´ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ñ–∏–¥–±–µ–∫–∞</h2>

          <div class="row">
            <div>
              <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
              <input type="color" id="feedbackBorderColor" value="#e67e22">
            </div>
            <div>
              <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
              <input type="color" id="feedbackTextColor" value="#ffffff">
            </div>
          </div>

          <div class="row">
            <div>
              <label>–§–æ–Ω —Ç–µ–∫—Å—Ç–∞ —Ñ–∏–¥–±–µ–∫–∞</label>
              <input type="color" id="feedbackBgColor" value="#131316">
            </div>
            <div style="display:flex; align-items:flex-end;">
              <label style="margin:0;">
                <input type="checkbox" id="feedbackNeon" checked> –ù–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ —Ñ–∏–¥–±–µ–∫–∞
              </label>
            </div>
          </div>

        </div>
      </details>

      <!-- SOUNDS -->
      <details class="section">
        <summary class="section-title">
          <div class="section-left">üîä –ó–≤—É–∫–∏ <i class="chev"></i></div>
          <div class="badge" id="badgeSounds">‚Äî</div>
        </summary>
        <div class="section-body">
          <label>–ó–≤—É–∫ –ª–æ–ø–∞–Ω–∏—è (URL)</label>
          <input type="url" id="popSound" placeholder="https://.../pop.mp3">

          <label>–ó–≤—É–∫ —Ñ–∏–¥–±–µ–∫–∞ / —Å—É–Ω–¥—É–∫–∞ (URL)</label>
          <input type="url" id="openSound" placeholder="https://.../open.mp3">

          <label>–ó–≤—É–∫ –æ—à–∏–±–∫–∏ (URL, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="url" id="wrongSound" placeholder="https://.../wrong.mp3">
        </div>
      </details>

      <!-- PUBLISH (buttons MUST be here, near iframe) -->
      <details class="section" open>
        <summary class="section-title">
          <div class="section-left">üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è <i class="chev"></i></div>
          <div class="badge" id="badgePublish">iframe</div>
        </summary>
        <div class="section-body">

          <div class="result">
            <textarea id="iframeOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è iframe –¥–ª—è Genially"></textarea>
            <div style="display:flex; flex-direction:column; gap:10px; align-items:stretch;">
              <button id="copyBtn" class="btn-ghost">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
          </div>

          <div class="pub-actions">
            <button id="testBtn" class="btn-ghost">üîç –í–∞–ª–∏–¥–∞—Ü–∏—è JSON</button>
            <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å iframe</button>
          </div>

          <div class="hint">–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à GitHub Pages).</div>
        </div>
      </details>

    </section>

    <!-- RIGHT -->
    <section class="card">
      <h2>üß™ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>

      <div class="preview-grid">
        <!-- HUD -->
        <div class="hud">
          <div id="iconPrev"></div>
          <div>
            <div id="textPrev">0 / 0</div>
            <div class="small-hint" style="margin-top:2px">
              –ò–∫–æ–Ω–∫–∞ ‚Äî –∏–∑ ¬´–ö–∞—Ä—Ç–∏–Ω–∫–∞ –ª–µ—Ç–∞—é—â–µ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞¬ª. –ö–æ–ª-–≤–æ –∑–∞–¥–∞–Ω–∏–π ‚Äî –ø–æ —Å—Ç—Ä–æ–∫–∞–º ¬´–í–æ–ø—Ä–æ—Å—ã¬ª.
            </div>
          </div>
        </div>

        <!-- Two preview panels -->
        <div class="preview-panels">
          <div class="preview-card">
            <div class="cap">
              <b>üé® –û–∫–Ω–æ –∑–∞–¥–∞–Ω–∏—è</b>
              <span class="badge" id="badgeTaskPreview">‚Äî</span>
            </div>

            <div id="taskPreviewBox">
              <div id="taskPreviewQuestion">Why do you like learning English?</div>

              <div class="mini-zone" style="background:rgba(0,0,0,0.18);">
                –ø–æ–ª–µ –æ—Ç–≤–µ—Ç–∞ / —Å–±–æ—Ä–∫–∞ —Å–ª–æ–≤
              </div>

              <div class="mini-zone" style="margin-top:10px; background:rgba(255,255,255,0.12);">
                –±–∞–Ω–∫ —Å–ª–æ–≤ / –≤–∞—Ä–∏–∞–Ω—Ç—ã
              </div>
            </div>

            <div class="small-hint" style="margin-top:10px">
              –≠—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è —Ä–∞–º–∫–∏/—Ñ–æ–Ω–∞. –ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª—å.
            </div>
          </div>

          <div class="preview-card">
            <div class="cap">
              <b>üí´ –§–∏–¥–±–µ–∫ (—Ç–µ–∫—Å—Ç)</b>
              <span class="badge" id="badgeFeedbackPreview">‚Äî</span>
            </div>

            <div id="feedbackPreviewBox">
              <div id="feedbackPreviewText">üéâ Well done!</div>
            </div>

            <div class="small-hint" style="margin-top:10px">
              –ü–æ–∫–∞–∑–∞–Ω–∞ –ø–ª–∞—à–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–±–µ–∑ —Å—É–Ω–¥—É–∫–∞), —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —Ä–∞–º–∫—É/—Ñ–æ–Ω/—Ü–≤–µ—Ç–∞.
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div class="summary" id="summaryBox">
          <div>–ó–∞–¥–∞–Ω–∏–π: <span id="sumTasks">0</span></div>
          <div>Order mode: <span id="sumOrder">OFF</span></div>
          <div>Feedback: <span id="sumFeedback">ON</span></div>
          <div>–ö–≤–∏–∑: <span id="sumQuiz">4</span> –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –¥–æ–±–æ—Ä: <span id="sumQuizFill">OFF</span></div>
          <div>–†–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤: <span id="sumScale">M</span></div>
        </div>

      </div>
    </section>
  </main>

  <script>
    const $ = s => document.querySelector(s);

    const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
    const PUBLISH_KEY = "nika_read_pub_2025";
    const BASE_MAIN   = "https://nikashum93.github.io/utki/main.html";

    // –Ø–∑—ã–∫–∏ –∏ —à—Ä–∏—Ñ—Ç—ã
    const LANGUAGE_OPTIONS = [
      { value: "ru", label: "–†—É—Å—Å–∫–∏–π" },
      { value: "en", label: "English" },
      { value: "es", label: "Espa√±ol" },
      { value: "de", label: "Deutsch" },
      { value: "fr", label: "Fran√ßais" },
      { value: "it", label: "Italiano" },
      { value: "zh", label: "‰∏≠Êñá" },
      { value: "ja", label: "Êó•Êú¨Ë™û" }
    ];

    const FONT_MAP = {
      ru: ["Rubik","PT Sans","Montserrat","Noto Sans"],
      en: ["Inter","Poppins","Roboto","Open Sans","Rubik"],
      es: ["Poppins","Montserrat","Noto Sans","Open Sans"],
      de: ["Fira Sans","Montserrat","Noto Sans","Open Sans"],
      fr: ["Poppins","Montserrat","Noto Sans","Open Sans"],
      it: ["Rubik","Inter","Noto Sans","Roboto","Arial"],
      zh: ["Noto Sans SC","Noto Serif SC"],
      ja: ["Noto Sans JP","Noto Serif JP"]
    };

    function fillLanguageSelect(){
      const sel = $('#language');
      sel.innerHTML = "";
      LANGUAGE_OPTIONS.forEach(opt => {
        const o = document.createElement('option');
        o.value = opt.value;
        o.textContent = opt.label;
        sel.appendChild(o);
      });
      sel.value = 'ru';
    }

    function fillFontsForLanguage(lang){
      const sel = $('#font');
      sel.innerHTML = "";
      const list = FONT_MAP[lang] || FONT_MAP.en;
      list.forEach(f => {
        const opt = document.createElement('option');
        opt.textContent = f;
        opt.value = f;
        sel.appendChild(opt);
      });
      sel.value = list[0];
      applyGoogleFont(sel.value);
    }

    function applyGoogleFont(fontName){
      if(!fontName) return;
      const gf = document.getElementById('gf');
      const family = fontName.replace(/ /g, '+');
      gf.href = `https://fonts.googleapis.com/css2?family=${family}:wght@400;700&display=swap`;
      document.body.style.fontFamily = fontName + ', system-ui, sans-serif';
    }

    function getUiScale(){
      const v = parseFloat($('#uiScale')?.value || '1');
      return (isFinite(v) && v>0) ? v : 1;
    }
    function scaleLabel(v){
      if (v <= 0.90) return 'S';
      if (v >= 1.10) return 'L';
      return 'M';
    }

    function collectConfig(){
      const lang = $('#language').value;
      const font = $('#font').value;
      const bgImage = $('#bgImage').value.trim();
      const finalFeedback = $('#finalFeedback').value.trim();
      const feedbackImage = $('#feedbackImage').value.trim();

      const popSoundUrl   = $('#popSound').value.trim()   || 'https://nikashum93.github.io/utki/pop.mp3';
      const openSoundUrl  = $('#openSound').value.trim()  || 'https://nikashum93.github.io/utki/open.mp3';
      const wrongSoundUrl = $('#wrongSound').value.trim(); // –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º

      // –í–æ–ø—Ä–æ—Å—ã / –æ—Ç–≤–µ—Ç—ã
      const qLines  = $('#questions').value.split('\n');
      const cLines  = $('#correctAnswers').value.split('\n');
      const wLines  = $('#wrongAnswers').value.split('\n');

      const maxLen = Math.max(qLines.length, cLines.length, wLines.length);
      const tasks = [];

      const isImageUrl = (s) => /^https?:\/\//i.test(s) && /\.(png|gif|jpe?g|webp)(\?.*)?$/i.test(s);

      for (let i=0; i<maxLen; i++){
        const q = (qLines[i] || '').trim();
        const cRaw = (cLines[i] || '').trim();
        const wRaw = (wLines[i] || '').trim();

        if (!q && !cRaw && !wRaw) continue;

        // –ï—Å–ª–∏ –≤ –≤–æ–ø—Ä–æ—Å–µ –ø—Ä–æ—Å—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ PNG/GIF/JPG/WEBP ‚Äî —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ–º-–∫–∞—Ä—Ç–∏–Ω–∫–æ–π
        if (q && !cRaw && !wRaw && isImageUrl(q)) {
          tasks.push({ type:'image', image:q });
          continue;
        }

        const correct = cRaw
          ? cRaw.split('|').map(s=>s.trim()).filter(Boolean)
          : [];
        const wrong = wRaw
          ? wRaw.split('|').map(s=>s.trim()).filter(Boolean)
          : [];

        tasks.push({ question: q, correct, wrong });
      }

      const taskBgColor     = $('#taskBgColor').value;
      const taskBorderColor = $('#taskBorderColor').value;
      const taskTextColor   = $('#taskTextColor').value;
      const taskBgOpacity   = parseFloat($('#taskBgOpacity').value) || 1;
      const baseTaskFontSize = parseInt($('#taskFontSize').value) || 22;
      const taskNeon        = $('#taskNeon').checked;

      const feedbackBorderColor = $('#feedbackBorderColor').value;
      const feedbackTextColor   = $('#feedbackTextColor').value;
      const feedbackNeon        = $('#feedbackNeon').checked;
      const feedbackBgColor     = $('#feedbackBgColor').value;
      const feedbackEnabled     = $('#feedbackEnabled').checked;
      const orderMode           = $('#orderMode').checked;

      const autoDistractors     = $('#autoDistractors').checked;

      // NEW:
      const quizUseOtherCorrect = $('#quizUseOtherCorrect')?.checked || false;
      const quizMaxOptions      = parseInt($('#quizMaxOptions')?.value || '4', 10);

      // NEW: —Ä–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      const uiScale = getUiScale();
      const scaledTaskFontSize = Math.round(baseTaskFontSize * uiScale);

      return {
        language: lang,
        lang, // alias –¥–ª—è main.html (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
        font,

        uiScale, // new (main –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å ‚Äî –Ω–µ –ª–æ–º–∞–µ—Ç)

        sounds: {
          pop:  popSoundUrl,
          open: openSoundUrl,
          wrong: wrongSoundUrl
        },
        style: {
          bgImage,
          task: {
            bgColor:    taskBgColor,
            borderColor:taskBorderColor,
            textColor:  taskTextColor,
            opacity:    taskBgOpacity,
            fontSize:   scaledTaskFontSize, // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —É–∂–µ —Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º
            neon:       taskNeon
          },
          feedback: {
            bgColor:     feedbackBgColor,
            borderColor: feedbackBorderColor,
            textColor:   feedbackTextColor,
            neon:        feedbackNeon
          }
        },
        finalFeedback,
        feedbackImage,
        autoDistractors,

        // NEW: –∫–≤–∏–∑-–ª–∏–º–∏—Ç—ã
        quizUseOtherCorrect,
        quizMaxOptions,

        feedbackEnabled,
        orderMode,
        tasks
      };
    }

    function validate(cfg){
      if(!cfg.tasks || !cfg.tasks.length) return '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å.';
      return null;
    }

    async function publish(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }

      const id = makeIdFromFirstTask(cfg);
      const payload = {
        id,
        mode: "json",
        folder: "data",
        content: JSON.stringify(cfg, null, 2)
      };
      try{
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-Publish-Key": PUBLISH_KEY
          },
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const t = await res.text().catch(()=>res.statusText);
          throw new Error(t || 'Server error');
        }
        const iframe = `<iframe src="${BASE_MAIN}?id=${encodeURIComponent(id)}" width="900" height="640" style="border:0;" allow="autoplay" allowfullscreen></iframe>`;
        $('#iframeOut').value = iframe;
        alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à GitHub Pages).');
      }catch(e){
        alert("–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: " + e.message);
      }
    }

    function makeIdFromFirstTask(cfg){
      const firstQ = (cfg.tasks[0]?.question || 'task').trim();
      const slug = firstQ.toLowerCase()
        .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
        .slice(0,40) || 'task';
      const d=new Date(),p=n=>String(n).padStart(2,'0');
      const stamp = `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
      return `${slug}-${stamp}`;
    }

    async function quickTest(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }
      alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –í–æ–ø—Ä–æ—Å–æ–≤: ' + cfg.tasks.length);
      console.log(cfg);
    }

    function copyIframe(){
      const v = $('#iframeOut').value.trim();
      if(!v){ alert('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å iframe.'); return; }
      navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{});
    }

    // Preview helpers
    function countTasksFromQuestions(){
      return $('#questions').value
        .split('\n')
        .map(s=>s.trim())
        .filter(Boolean)
        .length;
    }

    function mix(a,b){ // quick gradient
      return `linear-gradient(135deg, ${a}, ${b})`;
    }

    function refreshPreview(){
      const url = $('#bgImage').value.trim();
      $('#iconPrev').style.backgroundImage = url ? `url(${url})` : 'none';

      const lines = countTasksFromQuestions();
      $('#textPrev').textContent = '0 / ' + (lines || 0);

      // badges
      $('#badgeTasks').textContent = (lines||0) + ' –∑–∞–¥–∞–Ω–∏–π';

      const cfg = collectConfig();

      // Modes badge
      const modesOn = [];
      if (cfg.orderMode) modesOn.push('ORDER');
      if (cfg.feedbackEnabled) modesOn.push('FEEDBACK');
      $('#badgeModes').textContent = modesOn.length ? modesOn.join(' + ') : 'OFF';
      $('#badgeModes').className = 'badge' + (modesOn.length ? ' on' : '');

      // Neon badge
      const neonOn = [];
      if (cfg.style?.task?.neon) neonOn.push('TASK');
      if (cfg.style?.feedback?.neon) neonOn.push('FB');
      $('#badgeNeon').textContent = neonOn.length ? ('NEON: ' + neonOn.join('+')) : 'NEON: OFF';
      $('#badgeNeon').className = 'badge' + (neonOn.length ? ' on' : '');

      // Summary
      $('#sumTasks').textContent = cfg.tasks?.length || 0;
      $('#sumOrder').textContent = cfg.orderMode ? 'ON' : 'OFF';
      $('#sumFeedback').textContent = cfg.feedbackEnabled ? 'ON' : 'OFF';
      $('#sumQuiz').textContent = cfg.quizMaxOptions || 4;
      $('#sumQuizFill').textContent = cfg.quizUseOtherCorrect ? 'ON' : 'OFF';
      $('#sumScale').textContent = scaleLabel(cfg.uiScale);

      // Task preview box styling
      const tp = $('#taskPreviewBox');
      tp.style.background = cfg.style.task.bgColor || '#4facfe';
      // If bgColor is a solid color, give a tiny ‚Äúdepth‚Äù gradient
      if ((cfg.style.task.bgColor||'').startsWith('#')) {
        tp.style.background = mix(cfg.style.task.bgColor, '#0b0b0b');
      }
      tp.style.opacity = (typeof cfg.style.task.opacity === 'number') ? String(cfg.style.task.opacity) : '1';
      tp.style.border = cfg.style.task.borderColor ? ('2px solid ' + cfg.style.task.borderColor) : '2px solid transparent';
      tp.style.color = cfg.style.task.textColor || '#fff';
      tp.style.boxShadow = cfg.style.task.neon
        ? `0 0 18px ${cfg.style.task.borderColor || '#ffffff'}, 0 10px 22px rgba(0,0,0,.35)`
        : `0 10px 22px rgba(0,0,0,.35)`;

      // apply scale to preview modal
      const s = cfg.uiScale || 1;
      tp.style.transform = `scale(${s})`;

      // font size preview (already scaled in cfg.style.task.fontSize)
      $('#taskPreviewQuestion').style.fontSize = (cfg.style.task.fontSize || 22) + 'px';

      // feedback preview styling
      const fp = $('#feedbackPreviewBox');
      fp.style.background = cfg.style.feedback.bgColor || '#131316';
      fp.style.border = cfg.style.feedback.borderColor ? ('2px solid ' + cfg.style.feedback.borderColor) : '2px solid transparent';
      fp.style.color = cfg.style.feedback.textColor || '#fff';
      fp.style.boxShadow = cfg.style.feedback.neon
        ? `0 0 20px ${cfg.style.feedback.borderColor || '#ffffff'}, 0 10px 22px rgba(0,0,0,.35)`
        : `0 10px 22px rgba(0,0,0,.35)`;
      fp.style.transform = `scale(${s})`;

      // feedback sample text
      const ft = ($('#finalFeedback').value.trim() || 'üéâ Well done!');
      $('#feedbackPreviewText').textContent = ft;

      // preview badges
      $('#badgeTaskPreview').textContent = `${cfg.style.task.fontSize || 22}px ¬∑ ${scaleLabel(cfg.uiScale)}`;
      $('#badgeFeedbackPreview').textContent = cfg.feedbackEnabled ? 'ON' : 'OFF';
      $('#badgeFeedbackPreview').className = 'badge' + (cfg.feedbackEnabled ? ' on' : '');

      // sounds badge
      const soundOn = [];
      if ($('#popSound').value.trim()) soundOn.push('POP');
      if ($('#openSound').value.trim()) soundOn.push('OPEN');
      if ($('#wrongSound').value.trim()) soundOn.push('WRONG');
      $('#badgeSounds').textContent = soundOn.length ? soundOn.join('+') : 'DEFAULT';
      $('#badgeSounds').className = 'badge' + (soundOn.length ? ' on' : '');

      // publish badge
      const iframeVal = $('#iframeOut').value.trim();
      $('#badgePublish').textContent = iframeVal ? '–≥–æ—Ç–æ–≤–æ' : 'iframe';
      $('#badgePublish').className = 'badge' + (iframeVal ? ' on' : '');
    }

    // Init
    fillLanguageSelect();
    fillFontsForLanguage($('#language').value);

    $('#language').addEventListener('change', e => {
      fillFontsForLanguage(e.target.value);
      refreshPreview();
    });
    $('#font').addEventListener('change', e => {
      applyGoogleFont(e.target.value);
      refreshPreview();
    });

    // Inputs to watch
    const watch = [
      'bgImage','questions','correctAnswers','wrongAnswers',
      'finalFeedback','feedbackImage',
      'taskBgColor','taskBorderColor','taskTextColor','taskBgOpacity','taskFontSize','taskNeon',
      'feedbackBorderColor','feedbackTextColor','feedbackBgColor','feedbackNeon',
      'feedbackEnabled','orderMode','autoDistractors',
      'quizUseOtherCorrect','quizMaxOptions',
      'popSound','openSound','wrongSound',
      'uiScale'
    ];
    watch.forEach(id => {
      const el = $('#'+id);
      if (!el) return;
      el.addEventListener('input', refreshPreview);
      el.addEventListener('change', refreshPreview);
    });

    $('#saveBtn').addEventListener('click', publish);
    $('#testBtn').addEventListener('click', quickTest);
    $('#copyBtn').addEventListener('click', copyIframe);

    refreshPreview();
  </script>
</body>
</html>
