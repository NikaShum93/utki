<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî –°–≤–µ—Ç–ª—è—á–∫–∏</title>

  <style>
    :root{
      --ui-acc:#ffd700;
      --ui-acc2:#ffbf00;
      --bg:#0b0b0d;
      --card:#121215;
      --ink:#f1f1f1;
      --muted:#b8b8b8;
      --stroke:#26262a;
      --soft:#17171b;
      --gap:16px;

      --shadow: 0 0 30px rgba(255,215,0,.08);
      --shadow2: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(255,215,0,.10), transparent 60%),
                  radial-gradient(900px 500px at 80% 0%, rgba(0,240,255,.06), transparent 55%),
                  var(--bg);
      color:var(--ink);
      font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex;
      flex-direction:column;
    }

    header{
      position:sticky; top:0; z-index:5;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:14px 18px;
      border-bottom:1px solid var(--stroke);
      background: rgba(11,11,13,.88);
      backdrop-filter: blur(10px);
    }
    header h1{
      margin:0;
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
      color:var(--ui-acc);
      display:flex; align-items:center; gap:10px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.85);
      white-space:nowrap;
    }

    main{
      display:grid;
      grid-template-columns: 520px 1fr;
      gap:22px;
      padding:18px;
      max-width:1560px;
      width:100%;
      margin:0 auto;
      align-items: start; /* ‚Üê –í–û–¢ –≠–¢–û */
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
    }

    .card h2{
      margin:0 0 12px;
      font-size:16px;
      color:var(--ui-acc);
      font-weight:900;
      letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }

    .section{
      border:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding:14px;
      margin-top:12px;
    }
    .section:first-child{margin-top:0}

    label{
      display:block;
      margin:10px 0 6px;
      font-size:14px;
      color:#fff;
      font-weight:700;
      line-height:1.25;
    }

    input[type=text], input[type=number], input[type=url], textarea, select{
      width:100%;
      background: #0f0f12;
      color:#fff;
      border:1px solid rgba(255,255,255,.16);
      border-radius: 12px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease, transform .15s ease;
    }
    textarea{min-height:86px; resize:vertical}
    input:focus, textarea:focus, select:focus{
      border-color: rgba(255,215,0,.55);
      box-shadow: 0 0 0 3px rgba(255,215,0,.14);
    }
    select{cursor:pointer}

    input[type="checkbox"], input[type="radio"]{transform: translateY(1px);}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:var(--gap)}
    .small-hint{font-size:12px; color:var(--muted); margin-top:6px; line-height:1.35}
    .hint{color:var(--muted); font-size:12px; margin-top:8px; line-height:1.45}

    .divider{
      height:1px;
      background: rgba(255,255,255,.06);
      margin:14px 0;
    }

    button{
      background: linear-gradient(90deg, var(--ui-acc2), var(--ui-acc));
      color:#0b0b0d;
      border:none;
      border-radius: 14px;
      font-weight:900;
      padding:12px 14px;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .15s ease, filter .15s ease;
      font-size:14px;
      box-shadow: 0 10px 30px rgba(255,215,0,.18);
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 34px rgba(255,215,0,.22);
    }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      color:#fff;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }
    .btn-ghost:hover{
      box-shadow: 0 12px 26px rgba(0,0,0,.25);
      transform: translateY(-1px);
    }
    .btn-mini{
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      font-weight:900;
    }

    .pub-wrap{
      display:grid;
      grid-template-columns: 1fr 220px;
      gap:14px;
      align-items:start;
    }
    .pub-left textarea{
      height:150px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12.5px;
    }
    .pub-right{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:stretch;
    }
    .pub-bottom{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:12px;
    }
    .pub-bottom button{width:100%;}

    .mode-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    .mode{
      display:flex; gap:10px;
      align-items:flex-start;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition: border-color .15s ease, box-shadow .15s ease, transform .12s ease;
      user-select:none;
    }
    .mode:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      border-color: rgba(255,215,0,.25);
    }
    .mode strong{display:block; font-size:13px; font-weight:900}
    .mode span{display:block; margin-top:2px; font-size:12px; color:var(--muted); line-height:1.25}

    .preview-stack{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .preview-item{
      border:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding:12px;
      box-shadow: var(--shadow2);
    }
    .preview-item h3{
      margin:0 0 10px;
      font-size:13px;
      font-weight:900;
      color: rgba(255,255,255,.9);
      display:flex; align-items:center; justify-content:space-between;
    }
    .kbd{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.85);
    }

    .range-row{
      display:grid;
      grid-template-columns: 1fr 88px;
      gap:10px;
      align-items:center;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--ui-acc);
    }

    .hidden{display:none !important;}
  </style>

  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap">
</head>

<body>
  <header>
    <h1>ü¶Ü –†–µ–¥–∞–∫—Ç–æ—Ä ¬´Utki¬ª <span class="pill">Neon UI</span></h1>
    <span class="pill" id="statusPill">–ì–æ—Ç–æ–≤</span>
  </header>

  <main>
    <!-- LEFT: Controls -->
    <section class="card">

      <div class="section">
        <h2>‚öôÔ∏è –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

        <div class="row">
          <div>
            <label>–Ø–∑—ã–∫</label>
            <select id="language"></select>
          </div>

          <div>
            <label>–®—Ä–∏—Ñ—Ç</label>
            <select id="font"></select>
            <div class="small-hint">–°–ø–∏—Å–æ–∫ —à—Ä–∏—Ñ—Ç–æ–≤ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ —è–∑—ã–∫—É, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ‚Äú–∫–≤–∞–¥—Ä–∞—Ç–∏–∫–æ–≤‚Äù.</div>
          </div>
        </div>

        <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ —É—Ç—ë–Ω–∫–∞/–ø—É–∑—ã—Ä—å–∫–∞ (URL)</label>
        <input type="url" id="bgImage" placeholder="https://.../duck.gif">

        <label>–†–∞–∑–º–µ—Ä —É—Ç—è—Ç/–ø—É–∑—ã—Ä—å–∫–æ–≤ (px)</label>
        <div class="range-row">
          <input type="range" id="bubbleSizeRange" min="40" max="160" step="2" value="80">
          <input type="number" id="bubbleSize" min="40" max="200" step="1" value="80">
        </div>
        <div class="small-hint">–≠—Ç–æ —Ä–∞–∑–º–µ—Ä ‚Äú–ª–æ–ø–∞–µ–º—ã—Ö‚Äù –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ –∏–≥—Ä–µ.</div>

        <div class="row" style="margin-top:10px">
          <div style="display:flex; flex-direction:column; gap:8px;">
            <label style="margin:0;">
              <input type="checkbox" id="lockNext" checked>
              –ù–µ–ª—å–∑—è –ª–æ–ø–Ω—É—Ç—å —Å–ª–µ–¥—É—é—â–∏–π, –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Ç–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ
            </label>
            <div class="small-hint">–í–∫–ª—é—á–µ–Ω–æ ‚Äî –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–≥–æ –ø–æ –æ–¥–Ω–æ–º—É.</div>
          </div>
          <div></div>
        </div>
      </div>

     <div class="section">
  <h2>üîä –ó–≤—É–∫–∏</h2>

  <div class="row">
    <div>
      <label>–ó–≤—É–∫ –ª–æ–ø–∞–Ω–∏—è (URL)</label>
      <input type="url" id="popSound" placeholder="https://.../pop.mp3">
    </div>
    <div>
      <label>–ó–≤—É–∫ —Ñ–∏–¥–±–µ–∫–∞ (URL)</label>
      <input type="url" id="openSound" placeholder="https://.../open.mp3">
    </div>
  </div>

  <div class="row" style="margin-top:10px;">
    <div>
      <label>–ó–≤—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (URL)</label>
      <input type="url" id="correctSound" placeholder="https://.../correct.mp3">
    </div>
    <div>
      <label>–ó–≤—É–∫ –æ—à–∏–±–∫–∏ (URL, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
      <input type="url" id="wrongSound" placeholder="https://.../wrong.mp3">
    </div>
  </div>
</div>


      <div class="section">
        <h2>üéØ –ó–∞–¥–∞–Ω–∏—è</h2>

        <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏–π (–æ–¥–∏–Ω —Ä–µ–∂–∏–º –Ω–∞ –≤–µ—Å—å –Ω–∞–±–æ—Ä)</label>
        <div class="mode-grid" id="modeGrid">
          <label class="mode">
            <input type="radio" name="mode" value="text" id="modeText" checked>
            <div>
              <strong>–¢–µ–∫—Å—Ç</strong>
              <span>–£—Å—Ç–Ω–æ/–Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–ª–∏–∫—É (–∫–∞–∫ –≤ –∏–≥—Ä–µ).</span>
            </div>
          </label>
          <label class="mode">
            <input type="radio" name="mode" value="input" id="modeInput">
            <div>
              <strong>–í–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç</strong>
              <span>–û–¥–∏–Ω –æ—Ç–≤–µ—Ç –Ω–∞ —Å—Ç—Ä–æ–∫—É (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ |).</span>
            </div>
          </label>
          <label class="mode">
            <input type="radio" name="mode" value="quiz" id="modeQuiz">
            <div>
              <strong>–ö–≤–∏–∑</strong>
              <span>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ + –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–±–µ–∑ —É–º–µ–Ω—å—à–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞).</span>
            </div>
          </label>
          <label class="mode">
            <input type="radio" name="mode" value="order" id="modeOrder">
            <div>
              <strong>–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤</strong>
              <span>–ò–≥—Ä–æ–∫ —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑ ‚Äú—á–∏–ø–æ–≤‚Äù –∏ –∂–º—ë—Ç ‚Äú–ì–æ—Ç–æ–≤–æ‚Äù.</span>
            </div>
          </label>
        </div>

        <div class="hint" id="modeHint" style="margin-top:10px;"></div>

        <div class="divider"></div>

        <label>–í–æ–ø—Ä–æ—Å—ã / –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
        <textarea id="questions" placeholder="Why do you like learning English?&#10;..."></textarea>

        <div id="answersBlock">
          <div id="correctBlock">
            <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞–±–æ—Ä—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
            <textarea id="correctAnswers" placeholder="because|I like it&#10;..."></textarea>
            <div class="small-hint">
              –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ ‚Äî –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞, –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ |.
            </div>
          </div>

          <div id="wrongBlock">
            <label>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞–±–æ—Ä—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
            <textarea id="wrongAnswers" placeholder="because I like|because learning&#10;..."></textarea>
            <div class="small-hint">
              –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞, –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ |.
            </div>
          </div>

          <div id="quizExtrasBlock">
            <label style="margin-top:10px;">
              <input type="checkbox" id="autoDistractors">
              –ë—Ä–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –ø—É—Å—Ç–æ)
            </label>
            <div class="small-hint">
              –ï—Å–ª–∏ wrong –Ω–µ –∑–∞–¥–∞–Ω—ã ‚Äî –ø–æ–¥–º–µ—à–∞–µ–º distractors –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.
            </div>

            <div class="row" style="margin-top:12px">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <label style="margin:0;">
                  <input type="checkbox" id="quizUseOtherCorrect">
                  –í –∫–≤–∏–∑–µ –¥–æ–±–∏—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç wrong)
                </label>
                <div class="small-hint">
                  –ï—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–µ–Ω—å—à–µ 2 ‚Äî –±—É–¥–µ—Ç —Ä–µ–∂–∏–º ¬´–≤–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç¬ª.
                </div>
              </div>

              <div>
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ –∫–≤–∏–∑–µ</label>
                <select id="quizMaxOptions">
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4" selected>4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                </select>
                <div class="small-hint">–†–µ–∫–æ–º–µ–Ω–¥—É—é 4.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>

        <div class="row">
          <div>
            <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–∑–∞–¥–∞–Ω–∏–µ + –≤–∞—Ä–∏–∞–Ω—Ç—ã + —Ñ–∏–¥–±–µ–∫)</label>
            <input type="number" id="baseFontSize" value="22" min="12" max="48">
            <div class="small-hint">–û–¥–∏–Ω —Ä–∞–∑–º–µ—Ä –Ω–∞ –≤—Å—ë.</div>
          </div>
          <div style="display:flex; align-items:flex-end;">
            <label style="margin:0;">
              <input type="checkbox" id="taskNeon" checked>
              –ù–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ –∑–∞–¥–∞–Ω–∏—è
            </label>
          </div>
        </div>

        <div class="row">
          <div>
            <label>–§–æ–Ω –∑–∞–¥–∞–Ω–∏—è</label>
            <input type="color" id="taskBgColor" value="#4facfe">
          </div>
          <div>
            <label>–†–∞–º–∫–∞ –∑–∞–¥–∞–Ω–∏—è</label>
            <input type="color" id="taskBorderColor" value="#00f2fe">
          </div>
        </div>

        <div class="row">
          <div>
            <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
            <input type="color" id="taskTextColor" value="#ffffff">
          </div>
          <div>
            <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ (0‚Äì1)</label>
            <input type="number" id="taskBgOpacity" value="1" step="0.05" min="0" max="1">
            <div class="small-hint">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–æ–Ω.</div>
          </div>
        </div>

        <div class="divider"></div>

        <h2>üí´ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫</h2>

        <div class="row">
          <div>
            <label>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <input type="text" id="finalFeedback" placeholder="üéâ Well Done!" value="üéâ Well Done!">
          </div>
          <div>
            <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Ñ–∏–¥–±–µ–∫–∞ (URL)</label>
            <input type="url" id="feedbackImage" placeholder="https://.../chest.png">
          </div>
        </div>

        <label style="margin-top:10px;">
          <input type="checkbox" id="feedbackEnabled" checked>
          –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫
        </label>

        <label>–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏–¥–±–µ–∫–µ</label>
        <div class="row">
          <label style="display:flex; gap:10px; align-items:center; margin:0; padding:10px 12px; border:1px solid rgba(255,255,255,.10); border-radius:14px; background:rgba(255,255,255,.04);">
            <input type="radio" name="fbMode" value="both" id="fbBoth" checked>
            –ö–∞—Ä—Ç–∏–Ω–∫–∞ + —Ç–µ–∫—Å—Ç
          </label>
          <label style="display:flex; gap:10px; align-items:center; margin:0; padding:10px 12px; border:1px solid rgba(255,255,255,.10); border-radius:14px; background:rgba(255,255,255,.04);">
            <input type="radio" name="fbMode" value="text" id="fbText">
            –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
          </label>
        </div>
        <div class="row" style="margin-top:10px;">
          <label style="display:flex; gap:10px; align-items:center; margin:0; padding:10px 12px; border:1px solid rgba(255,255,255,.10); border-radius:14px; background:rgba(255,255,255,.04);">
            <input type="radio" name="fbMode" value="image" id="fbImage">
            –¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞
          </label>
          <div class="small-hint" style="margin:0; display:flex; align-items:center;">
            –£–±—Ä–∞—Ç—å –∏ —Ç–µ–∫—Å—Ç, –∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–µ–ª—å–∑—è.
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label>–§–æ–Ω —Ç–µ–∫—Å—Ç–∞ —Ñ–∏–¥–±–µ–∫–∞</label>
            <input type="color" id="feedbackBgColor" value="#131316">
          </div>
          <div>
            <label>–†–∞–º–∫–∞ —Ñ–∏–¥–±–µ–∫–∞</label>
            <input type="color" id="feedbackBorderColor" value="#e67e22">
          </div>
        </div>

        <div class="row">
          <div>
            <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ —Ñ–∏–¥–±–µ–∫–∞</label>
            <input type="color" id="feedbackTextColor" value="#ffffff">
          </div>
          <div style="display:flex; align-items:flex-end;">
            <label style="margin:0;">
              <input type="checkbox" id="feedbackNeon" checked>
              –ù–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ —Ñ–∏–¥–±–µ–∫–∞
            </label>
          </div>
        </div>

      </div>

      <div class="section" id="publishSection">
        <h2>üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è <span class="pill" style="margin-left:auto;">iframe</span></h2>

        <div class="pub-wrap">
          <div class="pub-left">
            <label style="margin-top:0;">iframe –¥–ª—è Genially</label>
            <textarea id="iframeOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è iframe –¥–ª—è Genially"></textarea>
          </div>

          <div class="pub-right">
            <button id="copyBtn" class="btn-ghost btn-mini">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="testBtn" class="btn-ghost btn-mini">üîé –í–∞–ª–∏–¥–∞—Ü–∏—è JSON</button>
          </div>
        </div>

        <div class="pub-bottom">
          <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å iframe</button>
        </div>

        <div class="hint">–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å.</div>
      </div>

    </section>

    <!-- RIGHT: Preview -->
    <section class="card">
      <h2>üß™ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>

      <div class="preview-stack">

        <div class="preview-item">
          <h3>HUD / —Å—á—ë—Ç—á–∏–∫ <span class="kbd">0 / N</span></h3>
          <div id="hudPrev" style="display:inline-flex; align-items:center; gap:10px; padding:10px 12px; border-radius:14px; background:linear-gradient(135deg,#f6f9fc,#dff9fb); color:#2d3436; font-weight:900;">
            <div id="iconPrev" style="width:26px; height:26px; border-radius:8px; background:#222; background-size:contain; background-position:center; background-repeat:no-repeat;"></div>
            <div id="textPrev">0 / 0</div>
          </div>
          <div class="hint">–ò–∫–æ–Ω–∫–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ ‚Äú–ö–∞—Ä—Ç–∏–Ω–∫–∞ —É—Ç—ë–Ω–∫–∞/–ø—É–∑—ã—Ä—å–∫–∞‚Äù.</div>
        </div>

        <div class="preview-item">
          <h3>–ü—É–∑—ã—Ä—ë–∫ / —É—Ç—ë–Ω–æ–∫ <span class="kbd">size</span></h3>
          <div style="display:flex; align-items:center; gap:14px;">
            <img id="bubblePrev" alt="bubble preview" style="width:80px; height:auto; object-fit:contain; filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));" />
            <div class="hint" style="margin:0;">–†–∞–∑–º–µ—Ä –±–µ—Ä—ë—Ç—Å—è –∏–∑ ‚Äú–†–∞–∑–º–µ—Ä —É—Ç—è—Ç/–ø—É–∑—ã—Ä—å–∫–æ–≤‚Äù.</div>
          </div>
        </div>

        <div class="preview-item">
          <h3>–û–∫–Ω–æ –∑–∞–¥–∞–Ω–∏—è <span class="kbd" id="modeBadge">mode</span></h3>
          <div id="taskPrev" style="max-width:520px;"></div>
        </div>

        <div class="preview-item">
          <h3>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫ <span class="kbd" id="fbBadge">both</span></h3>
          <div id="fbPrev" style="max-width:520px;"></div>
        </div>

      </div>
    </section>
  </main>

  <script>
    const $ = s => document.querySelector(s);

    const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
    const PUBLISH_KEY = "nika_read_pub_2025";
    const BASE_MAIN   = "https://nikashum93.github.io/utki/main.html";

    // UI strings (for preview placeholders too)
    const UI = {
      ru:{inputPlaceholder:'–í–ø–∏—à–∏ –æ—Ç–≤–µ—Ç...', btnOk:'OK', done:'–ì–æ—Ç–æ–≤–æ'},
      en:{inputPlaceholder:'Type the answer...', btnOk:'OK', done:'Done'},
      es:{inputPlaceholder:'Escribe la respuesta...', btnOk:'OK', done:'Hecho'},
      de:{inputPlaceholder:'Antwort eingeben...', btnOk:'OK', done:'Fertig'},
      fr:{inputPlaceholder:'√âcris la r√©ponse...', btnOk:'OK', done:'Termin√©'},
      it:{inputPlaceholder:'Scrivi la risposta...', btnOk:'OK', done:'Fatto'},
      ja:{inputPlaceholder:'Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ‚Ä¶', btnOk:'OK', done:'ÂÆå‰∫Ü'},
      zh:{inputPlaceholder:'ËØ∑ËæìÂÖ•Á≠îÊ°à‚Ä¶', btnOk:'OK', done:'ÂÆåÊàê'}
    };
    function t(key){
      const lang = $('#language')?.value || 'ru';
      const dict = UI[lang] || UI.en;
      return dict[key] || key;
    }

    // Languages
    const LANGUAGE_OPTIONS = [
      { value: "ru", label: "–†—É—Å—Å–∫–∏–π" },
      { value: "en", label: "English" },
      { value: "es", label: "Espa√±ol" },
      { value: "de", label: "Deutsch" },
      { value: "fr", label: "Fran√ßais" },
      { value: "it", label: "Italiano" },
      { value: "zh", label: "‰∏≠Êñá" },
      { value: "ja", label: "Êó•Êú¨Ë™û" }
    ];

    // Font sets (safe per language)
    const FONT_SETS = {
      ru: {
        basic: ["Rubik","PT Sans","Montserrat","Noto Sans","Nunito","Comfortaa"],
        cartoon: ["Baloo 2","Fredoka","M PLUS Rounded 1c"],
        handwritten: ["Caveat","Neucha","Marck Script","Bad Script","Patrick Hand"],
        seasonal: ["Mountains of Christmas"]
      },
      en: {
        basic: ["Inter","Poppins","Roboto","Open Sans","Rubik","Nunito"],
        cartoon: ["Baloo 2","Fredoka","Bangers"],
        handwritten: ["Caveat","Patrick Hand","Indie Flower","Gloria Hallelujah"],
        seasonal: ["Mountains of Christmas","Snowburst One","Creepster"]
      },
      es: {
        basic: ["Poppins","Montserrat","Noto Sans","Open Sans","Nunito"],
        cartoon: ["Baloo 2","Fredoka","Bangers"],
        handwritten: ["Caveat","Patrick Hand","Indie Flower","Gloria Hallelujah"],
        seasonal: ["Mountains of Christmas","Snowburst One","Creepster"]
      },
      de: {
        basic: ["Fira Sans","Montserrat","Noto Sans","Open Sans","Nunito"],
        cartoon: ["Baloo 2","Fredoka","Bangers"],
        handwritten: ["Caveat","Patrick Hand","Indie Flower","Gloria Hallelujah"],
        seasonal: ["Mountains of Christmas","Snowburst One","Creepster"]
      },
      fr: {
        basic: ["Poppins","Montserrat","Noto Sans","Open Sans","Nunito"],
        cartoon: ["Baloo 2","Fredoka","Bangers"],
        handwritten: ["Caveat","Patrick Hand","Indie Flower","Gloria Hallelujah"],
        seasonal: ["Mountains of Christmas","Snowburst One","Creepster"]
      },
      it: {
        basic: ["Rubik","Inter","Noto Sans","Roboto","Nunito"],
        cartoon: ["Baloo 2","Fredoka","Bangers"],
        handwritten: ["Caveat","Patrick Hand","Indie Flower","Gloria Hallelujah"],
        seasonal: ["Mountains of Christmas","Snowburst One","Creepster"]
      },
      zh: {
        basic: ["Noto Sans SC","Noto Serif SC"],
        cartoon: ["ZCOOL KuaiLe"],
        handwritten: ["Long Cang"],
        seasonal: ["Noto Sans SC"]
      },
      ja: {
        basic: ["Noto Sans JP","Noto Serif JP"],
        cartoon: ["M PLUS Rounded 1c"],
        handwritten: ["Yomogi"],
        seasonal: ["Noto Sans JP"]
      }
    };

    function fillLanguageSelect(){
      const sel = $('#language');
      sel.innerHTML = "";
      LANGUAGE_OPTIONS.forEach(opt => {
        const o = document.createElement('option');
        o.value = opt.value;
        o.textContent = opt.label;
        sel.appendChild(o);
      });
      sel.value = 'ru';
    }

    function fillFontsForLanguage(lang){
      const sel = $('#font');
      sel.innerHTML = "";

      const sets = FONT_SETS[lang] || FONT_SETS.en;

      const addGroup = (label, arr) => {
        if(!arr || !arr.length) return;
        const og = document.createElement('optgroup');
        og.label = label;
        arr.forEach(f => {
          const opt = document.createElement('option');
          opt.textContent = f;
          opt.value = f;
          og.appendChild(opt);
        });
        sel.appendChild(og);
      };

      addGroup("‚Äî Basic ‚Äî", sets.basic);
      addGroup("‚Äî Cartoon ‚Äî", sets.cartoon);
      addGroup("‚Äî Handwritten ‚Äî", sets.handwritten);
      addGroup("‚Äî Seasonal ‚Äî", sets.seasonal);

      const first = (sets.basic && sets.basic[0]) ? sets.basic[0] : "Rubik";
      sel.value = first;
      applyGoogleFont(sel.value, lang);
    }

    function applyGoogleFont(fontName, lang){
      if(!fontName) return;
      const gf = document.getElementById('gf');
      const family = fontName.replace(/ /g, '+');
      gf.href = `https://fonts.googleapis.com/css2?family=${family}:wght@400;700;900&display=swap`;

      const fallbackByLang = {
        ru: `, "Noto Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        en: `, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        es: `, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        de: `, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        fr: `, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        it: `, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        zh: `, "Noto Sans SC", "Noto Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
        ja: `, "Noto Sans JP", "Noto Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`,
      };

      document.body.style.fontFamily = `"${fontName}"${fallbackByLang[lang] || fallbackByLang.en}`;
    }

    function getMode(){
      return document.querySelector('input[name="mode"]:checked')?.value || 'text';
    }

    function setModeHint(){
      const mode = getMode();
      const hint = $('#modeHint');

      const map = {
        text:  "–¢–µ–∫—Å—Ç: —É—Å—Ç–Ω–æ–µ/–æ–±—Å—É–∂–¥–µ–Ω–∏–µ. –û—Ç–≤–µ—Ç—ã –Ω–µ –Ω—É–∂–Ω—ã.",
        input: "–í–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç: –∑–∞–ø–æ–ª–Ω–∏ ¬´–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã¬ª. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–µ –Ω—É–∂–Ω—ã.",
        quiz:  "–ö–≤–∏–∑: –∑–∞–ø–æ–ª–Ω–∏ ¬´–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ¬ª –∏ ¬´–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ¬ª. –ï—Å–ª–∏ wrong –Ω–µ—Ç ‚Äî –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–¥–æ–±–æ—Ä.",
        order: "–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤: –≤ ¬´–í–æ–ø—Ä–æ—Å—ã¬ª –≤–ø–∏—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ü–µ–ª–∏–∫–æ–º. –ü–æ–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–µ –Ω—É–∂–Ω—ã."
      };
      hint.textContent = map[mode] || "";

      const answers = $('#answersBlock');
      const correctBlock = $('#correctBlock');
      const wrongBlock = $('#wrongBlock');
      const quizExtras = $('#quizExtrasBlock');

      if (mode === 'text' || mode === 'order'){
        answers.classList.add('hidden');
      } else {
        answers.classList.remove('hidden');
      }

      // input: only correct
      if (mode === 'input'){
        correctBlock.classList.remove('hidden');
        wrongBlock.classList.add('hidden');
        quizExtras.classList.add('hidden');
      }

      // quiz: correct + wrong + extras
      if (mode === 'quiz'){
        correctBlock.classList.remove('hidden');
        wrongBlock.classList.remove('hidden');
        quizExtras.classList.remove('hidden');
      }

      // badge
      $('#modeBadge').textContent = mode;
      refreshPreview();
    }

    function hexToRgb(hex){
      const h = (hex || '#000000').replace('#','');
      const r = parseInt(h.substring(0,2),16);
      const g = parseInt(h.substring(2,4),16);
      const b = parseInt(h.substring(4,6),16);
      return {r,g,b};
    }
    function rgbaFromHex(hex, a){
      const {r,g,b} = hexToRgb(hex);
      return `rgba(${r},${g},${b},${a})`;
    }

    function collectConfig(){
      const lang = $('#language').value;
      const font = $('#font').value;

      const bgImage = $('#bgImage').value.trim();
      const bubbleSize = Math.max(40, Math.min(200, parseInt($('#bubbleSize').value || '80', 10)));

      const finalFeedback = $('#finalFeedback').value.trim();
      const feedbackImage = $('#feedbackImage').value.trim();

     const popSoundUrl     = $('#popSound').value.trim()     || 'https://nikashum93.github.io/utki/pop.mp3';
const openSoundUrl    = $('#openSound').value.trim()    || 'https://nikashum93.github.io/utki/open.mp3';
const correctSoundUrl = $('#correctSound')?.value.trim() || 'https://nikashum93.github.io/utki/correct.mp3';
const wrongSoundUrl   = $('#wrongSound').value.trim();


      const mode = getMode();

      const qLines  = $('#questions').value.split('\n');
      const cLines  = $('#correctAnswers').value.split('\n');
      const wLines  = $('#wrongAnswers').value.split('\n');

      const maxLen = Math.max(qLines.length, cLines.length, wLines.length);
      const tasks = [];

      const isImageUrl = (s) => /^https?:\/\//i.test(s) && /\.(png|gif|jpe?g|webp)(\?.*)?$/i.test(s);

      for (let i=0; i<maxLen; i++){
        const q = (qLines[i] || '').trim();
        const cRaw = (cLines[i] || '').trim();
        const wRaw = (wLines[i] || '').trim();

        if (!q && !cRaw && !wRaw) continue;

        // image-only task
        if (q && !cRaw && !wRaw && isImageUrl(q)) {
          tasks.push({ type:'image', image:q });
          continue;
        }

        const correct = (mode === 'input' || mode === 'quiz')
          ? (cRaw ? cRaw.split('|').map(s=>s.trim()).filter(Boolean) : [])
          : [];

        const wrong = (mode === 'quiz')
          ? (wRaw ? wRaw.split('|').map(s=>s.trim()).filter(Boolean) : [])
          : [];

        tasks.push({ question: q, correct, wrong });
      }

      const baseFontSize = Math.max(12, Math.min(48, parseInt($('#baseFontSize').value || '22', 10)));

      const taskBgColor     = $('#taskBgColor').value;
      const taskBorderColor = $('#taskBorderColor').value;
      const taskTextColor   = $('#taskTextColor').value;
      const taskBgOpacity   = parseFloat($('#taskBgOpacity').value);
      const taskNeon        = $('#taskNeon').checked;

      const feedbackBorderColor = $('#feedbackBorderColor').value;
      const feedbackTextColor   = $('#feedbackTextColor').value;
      const feedbackNeon        = $('#feedbackNeon').checked;
      const feedbackBgColor     = $('#feedbackBgColor').value;

      const feedbackEnabled     = $('#feedbackEnabled').checked;
      const fbMode = document.querySelector('input[name="fbMode"]:checked')?.value || 'both';

      const autoDistractors     = $('#autoDistractors').checked;
      const quizUseOtherCorrect = $('#quizUseOtherCorrect')?.checked || false;
      const quizMaxOptions      = parseInt($('#quizMaxOptions')?.value || '4', 10);

      const lockNext = $('#lockNext').checked;

      // apply opacity ONLY to background (precomputed rgba)
      const bgRgba = rgbaFromHex(taskBgColor, isFinite(taskBgOpacity) ? taskBgOpacity : 1);

      return {
        language: lang,
        lang,
        font,
        mode,
        orderMode: (mode === 'order'),
        lockNext: !!lockNext,
        bubbleSize,
       sounds: {
  pop:     popSoundUrl,
  open:    openSoundUrl,
  correct: correctSoundUrl,
  wrong:   wrongSoundUrl
},

        style: {
          bgImage,
          bubbleSize,
          task: {
            bgColor:     bgRgba,
            borderColor: taskBorderColor,
            textColor:   taskTextColor,
            fontSize:    baseFontSize,
            neon:        taskNeon
          },
          feedback: {
            bgColor:     feedbackBgColor,
            borderColor: feedbackBorderColor,
            textColor:   feedbackTextColor,
            fontSize:    baseFontSize,
            neon:        feedbackNeon
          }
        },
        finalFeedback,
        feedbackImage,
        feedbackEnabled,
        feedbackMode: fbMode, // both|text|image
        autoDistractors,
        quizUseOtherCorrect,
        quizMaxOptions,
        tasks
      };
    }

    function validate(cfg){
      if(!cfg.tasks || !cfg.tasks.length) return '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å.';
      if(cfg.feedbackEnabled){
        if(!['both','text','image'].includes(cfg.feedbackMode)) return '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ñ–∏–¥–±–µ–∫–∞.';
        if(cfg.feedbackMode === 'image' && !cfg.feedbackImage) return '–î–ª—è —Ä–µ–∂–∏–º–∞ ‚Äú—Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞‚Äù –Ω—É–∂–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É.';
        if(cfg.feedbackMode === 'text' && !cfg.finalFeedback) return '–î–ª—è —Ä–µ–∂–∏–º–∞ ‚Äú—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç‚Äù –Ω—É–∂–µ–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç.';
        if(cfg.feedbackMode === 'both' && !cfg.feedbackImage && !cfg.finalFeedback) return '–ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞.';
      }
      return null;
    }

    async function publish(){
      $('#statusPill').textContent = '–ü—É–±–ª–∏–∫—É—é‚Ä¶';
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); $('#statusPill').textContent = '–û—à–∏–±–∫–∞'; return; }

      const id = makeIdFromFirstTask(cfg);
      const payload = {
        id,
        mode: "json",
        folder: "data",
        content: JSON.stringify(cfg, null, 2)
      };

      try{
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-Publish-Key": PUBLISH_KEY
          },
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const t = await res.text().catch(()=>res.statusText);
          throw new Error(t || 'Server error');
        }
        const iframe = `<iframe src="${BASE_MAIN}?id=${encodeURIComponent(id)}" width="900" height="640" style="border:0;" allow="autoplay" allowfullscreen></iframe>`;
        $('#iframeOut').value = iframe;

        $('#statusPill').textContent = '–ì–æ—Ç–æ–≤–æ ‚úÖ';
        alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30‚Äì60 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å.');
      }catch(e){
        $('#statusPill').textContent = '–°–µ—Ç—å/–æ—à–∏–±–∫–∞';
        alert("–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: " + e.message);
      }
    }

    function makeIdFromFirstTask(cfg){
      const firstQ = (cfg.tasks[0]?.question || 'task').trim();
      const slug = firstQ.toLowerCase()
        .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
        .slice(0,40) || 'task';
      const d=new Date(),p=n=>String(n).padStart(2,'0');
      const stamp = `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
      return `${slug}-${stamp}`;
    }

    async function quickTest(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }
      alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –í–æ–ø—Ä–æ—Å–æ–≤: ' + cfg.tasks.length);
      console.log(cfg);
    }

    function copyIframe(){
      const v = $('#iframeOut').value.trim();
      if(!v){ alert('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å iframe.'); return; }
      navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{});
    }

    function syncBubbleSize(from){
      const r = $('#bubbleSizeRange');
      const n = $('#bubbleSize');
      if (from === 'range') n.value = r.value;
      else r.value = n.value;
      refreshPreview();
    }

    // Preview
    function refreshPreview(){
      const cfg = collectConfig();

      // HUD
      const url = cfg.style.bgImage;
      $('#iconPrev').style.backgroundImage = url ? `url(${url})` : 'none';
      const lines = $('#questions').value.split('\n').map(s=>s.trim()).filter(Boolean).length;
      $('#textPrev').textContent = '0 / ' + (lines || 0);

      // Bubble preview
      const bubbleEl = $('#bubblePrev');
      if (url){
        bubbleEl.src = url;
        bubbleEl.style.width = (cfg.bubbleSize || 80) + 'px';
        bubbleEl.style.display = 'block';
      } else {
        bubbleEl.removeAttribute('src');
        bubbleEl.style.display = 'none';
      }

      // Task preview (as in game)
      const taskPrev = $('#taskPrev');
      taskPrev.innerHTML = '';

      const fs = cfg.style.task.fontSize || 22;

      const modal = document.createElement('div');
      modal.style.borderRadius = '18px';
      modal.style.padding = '16px';
      modal.style.background = cfg.style.task.bgColor || '#4facfe';
      modal.style.border = `2px solid ${cfg.style.task.borderColor || '#00f2fe'}`;
      modal.style.color = cfg.style.task.textColor || '#fff';
      modal.style.fontSize = fs + 'px';
      modal.style.fontWeight = '900';
      modal.style.boxShadow = cfg.style.task.neon
        ? `0 0 18px ${cfg.style.task.borderColor || '#00f2fe'}`
        : '0 10px 26px rgba(0,0,0,.25)';

      const q = document.createElement('div');
      q.textContent = 'Why do you like learning English?';
      q.style.marginBottom = '10px';
      modal.appendChild(q);

      const mode = cfg.mode;

      if (mode === 'quiz'){
        const list = document.createElement('div');
        list.style.display = 'flex';
        list.style.flexDirection = 'column';
        list.style.gap = '8px';

        ['Because I love it','Because it is easy','Because I can travel','Because I must'].forEach(txt=>{
          const b = document.createElement('button');
          b.type = 'button';
          b.textContent = txt;
          b.style.border = 'none';
          b.style.borderRadius = '999px';
          b.style.padding = '10px 12px';
          b.style.background = 'rgba(255,255,255,.90)';
          b.style.color = '#111';
          b.style.fontSize = fs + 'px';     // –ù–ï –º–µ–Ω—å—à–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞–Ω–∏—è
          b.style.fontWeight = '900';
          b.style.cursor = 'pointer';
          list.appendChild(b);
        });
        modal.appendChild(list);
      } else if (mode === 'input'){
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.placeholder = t('inputPlaceholder');
        inp.style.width = '100%';
        inp.style.border = 'none';
        inp.style.borderRadius = '12px';
        inp.style.padding = '10px 12px';
        inp.style.fontSize = fs + 'px';
        inp.style.fontWeight = '900';
        inp.style.color = '#111';
        inp.style.background = 'rgba(255,255,255,.90)';
        modal.appendChild(inp);

        const ok = document.createElement('button');
        ok.type = 'button';
        ok.textContent = t('btnOk');
        ok.style.marginTop = '10px';
        ok.style.borderRadius = '999px';
        ok.style.padding = '10px 14px';
        ok.style.border = 'none';
        ok.style.fontSize = fs + 'px';
        ok.style.fontWeight = '900';
        ok.style.background = 'rgba(0,0,0,.22)';
        ok.style.color = '#fff';
        modal.appendChild(ok);

      } else if (mode === 'order'){
        // ONLY chips + button "Done" (no shown sentence —Å–≤–µ—Ä—Ö—É!)
        const chips = document.createElement('div');
        chips.style.display = 'flex';
        chips.style.flexWrap = 'wrap';
        chips.style.gap = '8px';
        chips.style.marginTop = '8px';

        ['Why','do','you','like','learning','English','?'].forEach(w=>{
          const c = document.createElement('div');
          c.textContent = w;
          c.style.background = 'rgba(255,255,255,.92)';
          c.style.color = '#111';
          c.style.borderRadius = '999px';
          c.style.padding = '8px 12px';
          c.style.fontSize = fs + 'px';
          c.style.fontWeight = '900';
          c.style.boxShadow = '0 8px 16px rgba(0,0,0,.22)';
          c.style.transition = 'transform .12s ease';
          c.onmouseenter = () => c.style.transform = 'translateY(-1px)';
          c.onmouseleave = () => c.style.transform = 'translateY(0)';
          chips.appendChild(c);
        });
        modal.appendChild(chips);

        const done = document.createElement('button');
        done.type = 'button';
        done.textContent = t('done');
        done.style.marginTop = '10px';
        done.style.borderRadius = '999px';
        done.style.padding = '10px 14px';
        done.style.border = 'none';
        done.style.fontSize = fs + 'px';
        done.style.fontWeight = '900';
        done.style.background = 'rgba(0,0,0,.22)';
        done.style.color = '#fff';
        modal.appendChild(done);

      } else {
        const txt = document.createElement('div');
        txt.textContent = 'Click to close‚Ä¶';
        txt.style.opacity = '.9';
        modal.appendChild(txt);
      }

      taskPrev.appendChild(modal);

      // Feedback preview
      const fbPrev = $('#fbPrev');
      fbPrev.innerHTML = '';
      const fbMode = cfg.feedbackMode || 'both';
      $('#fbBadge').textContent = fbMode;

      const wrap = document.createElement('div');
      wrap.style.display = 'grid';
      wrap.style.gridTemplateColumns = '1fr';
      wrap.style.gap = '10px';

      if (!cfg.feedbackEnabled){
        const off = document.createElement('div');
        off.textContent = '–§–∏–¥–±–µ–∫ –≤—ã–∫–ª—é—á–µ–Ω';
        off.style.opacity = '.75';
        off.style.fontSize = '13px';
        wrap.appendChild(off);
        fbPrev.appendChild(wrap);
        return;
      }

      if (fbMode === 'both' || fbMode === 'image'){
        const img = document.createElement('div');
        img.style.height = '96px';
        img.style.borderRadius = '14px';
        img.style.border = '1px solid rgba(255,255,255,.14)';
        img.style.background = cfg.feedbackImage
          ? `url(${cfg.feedbackImage}) center/contain no-repeat rgba(255,255,255,.05)`
          : `linear-gradient(135deg, rgba(255,215,0,.18), rgba(0,240,255,.08))`;
        img.style.boxShadow = '0 10px 24px rgba(0,0,0,.25)';
        wrap.appendChild(img);
      }

      if (fbMode === 'both' || fbMode === 'text'){
        const label = document.createElement('div');
        const border2 = cfg.style.feedback.borderColor || '#e67e22';
        label.textContent = cfg.finalFeedback || 'üéâ Well Done!';
        label.style.padding = '12px 14px';
        label.style.borderRadius = '14px';
        label.style.border = `2px solid ${border2}`;
        label.style.background = cfg.style.feedback.bgColor || '#131316';
        label.style.color = cfg.style.feedback.textColor || '#fff';
        label.style.fontSize = (cfg.style.feedback.fontSize || fs) + 'px';
        label.style.fontWeight = '900';
        label.style.textAlign = 'center';
        label.style.boxShadow = cfg.style.feedback.neon ? `0 0 20px ${border2}` : '0 10px 24px rgba(0,0,0,.25)';
        wrap.appendChild(label);
      }

      fbPrev.appendChild(wrap);
    }

    // Init
    fillLanguageSelect();
    fillFontsForLanguage($('#language').value);

    $('#language').addEventListener('change', e => {
      fillFontsForLanguage(e.target.value);
      refreshPreview();
    });

    $('#font').addEventListener('change', e => {
      applyGoogleFont(e.target.value, $('#language').value);
      refreshPreview();
    });

    document.querySelectorAll('input[name="mode"]').forEach(r=>{
      r.addEventListener('change', setModeHint);
    });

    $('#bubbleSizeRange').addEventListener('input', ()=>syncBubbleSize('range'));
    $('#bubbleSize').addEventListener('input', ()=>syncBubbleSize('number'));

    // live preview
    [
      'bgImage','questions','finalFeedback','feedbackImage',
      'taskBgColor','taskBorderColor','taskTextColor','taskBgOpacity','taskNeon',
      'feedbackBgColor','feedbackBorderColor','feedbackTextColor','feedbackNeon',
      'baseFontSize','feedbackEnabled','quizMaxOptions','quizUseOtherCorrect','autoDistractors',
     'lockNext','popSound','openSound','correctSound','wrongSound','correctAnswers','wrongAnswers'

    ].forEach(id => {
      const el = $('#'+id);
      if(!el) return;
      el.addEventListener('input', refreshPreview);
      el.addEventListener('change', refreshPreview);
    });

    document.querySelectorAll('input[name="fbMode"]').forEach(r=>{
      r.addEventListener('change', refreshPreview);
    });

    $('#saveBtn').addEventListener('click', publish);
    $('#testBtn').addEventListener('click', quickTest);
    $('#copyBtn').addEventListener('click', copyIframe);

    setModeHint();
    refreshPreview();
  </script>
</body>
</html>
