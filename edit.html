<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî Utki</title>
  <style>
    :root{
      --ui-acc:#ffd700;
      --ui-acc2:#00f0ff;
      --bg:#0b0b0f;
      --card:#12121a;
      --card2:#0f0f16;
      --ink:#f2f2f6;
      --muted:#b7b7c6;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.16);
      --gap:14px;
      --radius:16px;
      --shadow: 0 0 34px rgba(255,215,0,.06);
      --neon: 0 0 18px rgba(0,240,255,.25), 0 0 28px rgba(255,215,0,.10);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 20% -10%, rgba(0,240,255,.10), transparent 55%),
                      radial-gradient(900px 600px at 95% 0%, rgba(255,215,0,.10), transparent 55%),
                      var(--bg);
      color:var(--ink);
      font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; flex-direction:column;
    }

    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:16px 20px;
      border-bottom:1px solid var(--stroke);
      position:sticky; top:0;
      background:linear-gradient(180deg, rgba(11,11,15,.92), rgba(11,11,15,.75));
      backdrop-filter: blur(10px);
      z-index:10;
    }
    header h1{
      font-size:18px; margin:0; letter-spacing:.2px;
      color:var(--ui-acc); font-weight:900;
      text-shadow: 0 0 16px rgba(255,215,0,.18);
    }
    header .sub{
      font-size:12px; color:var(--muted);
      opacity:.9;
    }

    main{
      display:grid; grid-template-columns: 520px 1fr;
      gap:18px; padding:18px; max-width:1580px;
      width:100%; margin:0 auto;
    }

    .card{
      background:linear-gradient(180deg, rgba(18,18,26,.92), rgba(15,15,22,.92));
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
    }
    .card h2{
      margin:0 0 12px; font-size:14px;
      color:var(--ui-acc);
      font-weight:900; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
    .grid3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:var(--gap)}
    .stack{display:flex; flex-direction:column; gap:var(--gap)}
    .divider{
      height:1px; background:rgba(255,255,255,.06);
      margin:14px 0;
    }

    label{
      display:block; margin:10px 0 6px;
      font-size:12px; color:#fff;
      font-weight:800; letter-spacing:.2px;
      line-height:1.25;
    }
    .hint{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35}

    input[type=text], input[type=number], input[type=url], textarea, select{
      width:100%;
      background:rgba(10,10,16,.8);
      color:#fff;
      border:1px solid rgba(255,255,255,.16);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    textarea{min-height:86px; resize:vertical}
    input:focus, textarea:focus, select:focus{
      border-color:rgba(0,240,255,.40);
      box-shadow: 0 0 0 3px rgba(0,240,255,.12), 0 0 18px rgba(255,215,0,.07);
    }
    select{cursor:pointer}
    input[type="checkbox"]{transform: translateY(1px);}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
    }
    .pill strong{font-size:12px}
    .pill span{font-size:12px; color:var(--muted)}

    .btnRow{
      display:flex; gap:10px; align-items:center; justify-content:flex-end;
      flex-wrap:wrap;
    }
    button{
      background:linear-gradient(90deg,#ffbf00,#ffd700);
      color:#0a0a0e;
      border:none;
      border-radius:12px;
      font-weight:900;
      padding:12px 14px;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
      font-size:14px;
      box-shadow: 0 10px 28px rgba(255,215,0,.12);
    }
    button:hover{transform:translateY(-1px); filter:saturate(1.05)}
    .btn-ghost{
      background:transparent; color:#fff;
      border:1px solid rgba(255,255,255,.18);
      box-shadow:none;
    }
    .btn-ghost:hover{box-shadow:0 0 0 3px rgba(0,240,255,.10)}
    .btn-mini{
      padding:10px 12px;
      border-radius:10px;
      font-size:13px;
    }

    .result{
      display:grid; grid-template-columns:1fr auto;
      gap:10px; align-items:start;
    }
    .result textarea{
      height:120px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12px;
      line-height:1.35;
    }

    /* Right preview column: stacked blocks */
    .previewBlock{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:14px;
      background:linear-gradient(180deg, rgba(12,12,18,.7), rgba(8,8,12,.55));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .previewTitle{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin:0 0 10px;
      font-weight:900; font-size:12px;
      color:var(--ui-acc);
    }
    .previewStage{
      position:relative;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      padding:14px;
      overflow:hidden;
    }

    /* Fake in-preview task card */
    .pv-card{
      margin:0 auto;
      max-width:680px;
      width:100%;
      border-radius:18px;
      padding:18px 20px;
      color:#fff;
      text-align:center;
      border:2px solid transparent;
      box-shadow: 0 10px 26px rgba(0,0,0,.28);
    }
    .pv-q{
      font-weight:900;
      margin-bottom:12px;
    }
    .pv-btn{
      display:inline-flex; align-items:center; justify-content:center;
      border:none; cursor:pointer;
      border-radius:999px;
      padding:12px 16px;
      font-weight:900;
      background:rgba(255,255,255,.92);
      color:#1c1c24;
      font-size:inherit;
    }
    .pv-input{
      width:min(520px, 100%);
      background:rgba(255,255,255,.92);
      border:none; border-radius:14px;
      padding:12px 12px;
      font-weight:800;
      font-size:inherit;
      color:#1c1c24;
      margin: 0 auto 10px;
      display:block;
    }
    .pv-quiz{
      display:flex; flex-direction:column;
      gap:10px;
      max-width:520px;
      margin: 8px auto 0;
    }
    .pv-chipBank{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
      padding:12px; border-radius:14px;
      background:rgba(255,255,255,.14);
      margin-top:10px;
    }
    .pv-chipLine{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
      padding:12px; border-radius:14px;
      background:rgba(0,0,0,.18);
      min-height:54px;
    }
    .pv-chip{
      border:none; cursor:pointer;
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      background:rgba(255,255,255,.92);
      color:#1c1c24;
      font-size:inherit;
    }

    /* Counter preview */
    .pv-counter{
      display:inline-flex; align-items:center; gap:10px;
      background:linear-gradient(135deg, rgba(255,255,255,.94), rgba(223,249,251,.92));
      color:#1c1c24;
      padding:10px 14px;
      border-radius:14px;
      font-weight:900;
    }
    .pv-counter .icon{
      width:26px; height:26px;
      border-radius:8px;
      background:rgba(0,0,0,.08);
      background-size:contain;
      background-position:center;
      background-repeat:no-repeat;
    }

    .smallRow{display:flex; gap:10px; flex-wrap:wrap}
    .smallRow > .pill{flex:1; min-width:240px}

    /* color inputs */
    input[type="color"]{
      width:100%;
      height:42px;
      padding:0;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background:transparent;
    }
  </style>
  <link id="gf" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap">
</head>
<body>
  <header>
    <div>
      <h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´Utki¬ª</h1>
      <div class="sub">–ß–∏—Å—Ç–æ, –Ω–µ–æ–Ω–æ–≤–æ, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ ‚Äî –∏ –ø—Ä–µ–≤—å—é –∫–∞–∫ –≤ –∏–≥—Ä–µ.</div>
    </div>
  </header>

  <main>
    <!-- LEFT: editor -->
    <section class="card">
      <h2>‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

      <div class="grid2">
        <div>
          <label>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
          <select id="language"></select>
          <div class="hint">–í–ª–∏—è–µ—Ç –Ω–∞ placeholder –∏ –ø–æ–¥–ø–∏—Å–∏ –∫–Ω–æ–ø–æ–∫ –≤ –ø—Ä–µ–≤—å—é –∏ –≤ –∏–≥—Ä–µ.</div>
        </div>
        <div>
          <label>–®—Ä–∏—Ñ—Ç</label>
          <select id="font"></select>
          <div class="hint">–®—Ä–∏—Ñ—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ –∏–≥—Ä–µ, –µ—Å–ª–∏ —Ç—ã –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∞–µ—à—å —Ç–∞–º).</div>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äú—É—Ç–∫–∏/–ø—É–∑—ã—Ä—è‚Äù (URL)</label>
          <input type="url" id="bgImage" placeholder="https://.../duck.gif">
          <div class="hint">–≠—Ç–∞ –∂–µ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–¥—ë—Ç –≤ –∏–∫–æ–Ω–∫—É —Å—á—ë—Ç—á–∏–∫–∞.</div>
        </div>
        <div>
          <label>–†–∞–∑–º–µ—Ä ‚Äú—É—Ç–∫–∏/–ø—É–∑—ã—Ä—è‚Äù (px)</label>
          <input type="number" id="bubbleSize" value="80" min="20" max="300" step="1">
          <div class="hint">–ó–∞–ø–∏—à–µ—Ç—Å—è –≤ JSON –∫–∞–∫ <b>bubbleSize</b>.</div>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
          <input type="text" id="finalFeedback" placeholder="üéâ Well Done!">
        </div>
        <div>
          <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Ñ–∏–¥–±–µ–∫–∞ (URL)</label>
          <input type="url" id="feedbackImage" placeholder="https://.../chest.png">
        </div>
      </div>

      <div class="grid2" style="align-items:end">
        <div>
          <label>–§–∏–¥–±–µ–∫ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫</label>
          <select id="feedbackMode">
            <option value="both" selected>–ö–∞—Ä—Ç–∏–Ω–∫–∞ + —Ç–µ–∫—Å—Ç</option>
            <option value="text">–¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç</option>
            <option value="image">–¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞</option>
          </select>
          <div class="hint">‚Äú–ù–∏—á–µ–≥–æ‚Äù –≤—ã–±—Ä–∞—Ç—å –Ω–µ–ª—å–∑—è ‚Äî –ø–æ —Ç–≤–æ–µ–º—É –ø—Ä–∞–≤–∏–ª—É.</div>
        </div>
        <div class="pill">
          <strong><input type="checkbox" id="feedbackEnabled" checked> –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫</strong>
          <span>(–º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é)</span>
        </div>
      </div>

      <div class="divider"></div>

      <h2>üîä –ó–≤—É–∫–∏</h2>
      <div class="grid2">
        <div>
          <label>–ó–≤—É–∫ –ª–æ–ø–∞–Ω–∏—è (URL)</label>
          <input type="url" id="popSound" placeholder="https://.../pop.mp3">
        </div>
        <div>
          <label>–ó–≤—É–∫ —Ñ–∏–¥–±–µ–∫–∞ (URL)</label>
          <input type="url" id="openSound" placeholder="https://.../open.mp3">
        </div>
      </div>

      <div class="divider"></div>

      <h2>üéØ –†–µ–∂–∏–º—ã –∏ –∑–∞–¥–∞–Ω–∏—è</h2>

      <div class="stack">
        <div class="smallRow">
          <div class="pill">
            <strong><input type="checkbox" id="orderMode"> –†–µ–∂–∏–º ‚Äú–ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤‚Äù</strong>
            <span>–¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤</span>
          </div>
          <div class="pill">
            <strong><input type="checkbox" id="autoDistractors"> –ê–≤—Ç–æ-distractors</strong>
            <span>–µ—Å–ª–∏ wrong –ø—É—Å—Ç—ã–µ</span>
          </div>
        </div>

        <div class="hint">
          –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–µ–∂–∏–º —É –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏:
          <br>‚Ä¢ <b>TEXT</b> ‚Äî –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω–æ –Ω–µ—Ç correct/wrong ‚Üí —É—Å—Ç–Ω–æ, –∫–Ω–æ–ø–∫–∞ ‚ÄúDone‚Äù
          <br>‚Ä¢ <b>INPUT</b> ‚Äî –≤ correct —Ä–æ–≤–Ω–æ 1 –≤–∞—Ä–∏–∞–Ω—Ç ‚Üí –≤–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞
          <br>‚Ä¢ <b>QUIZ</b> ‚Äî correct –µ—Å—Ç—å –∏ –µ—Å—Ç—å 2+ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (correct+wrong) ‚Üí –∫–Ω–æ–ø–∫–∏
          <br>‚Ä¢ <b>ORDER</b> ‚Äî –≤–∫–ª—é—á—ë–Ω ‚Äú–ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤‚Äù –∏ —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ correct/wrong ‚Üí —Å–æ–±–µ—Ä–∏ —Ñ—Ä–∞–∑—É –∏–∑ —Å–ª–æ–≤
        </div>

        <div class="grid2">
          <div>
            <label>–í–æ–ø—Ä–æ—Å—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫–µ)</label>
            <textarea id="questions" placeholder="Write your question here..."></textarea>
          </div>
          <div>
            <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ —Å—Ç—Ä–æ–∫–∞–º, –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ |)</label>
            <textarea id="correctAnswers" placeholder="answer1|answer2"></textarea>
            <div class="hint">–ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —ç—Ç–æ TEXT (–∏–ª–∏ ORDER, –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω).</div>
          </div>
        </div>

        <div>
          <label>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ —Å—Ç—Ä–æ–∫–∞–º, –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ |)</label>
          <textarea id="wrongAnswers" placeholder="wrong1|wrong2"></textarea>
        </div>

        <div class="grid2" style="align-items:end">
          <div class="pill" style="justify-content:space-between">
            <strong><input type="checkbox" id="quizUseOtherCorrect"> –î–æ–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑ –¥—Ä—É–≥–∏—Ö correct</strong>
            <span>–¥–ª—è QUIZ</span>
          </div>
          <div>
            <label>–ö–æ–ª-–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ –∫–≤–∏–∑–µ</label>
            <select id="quizMaxOptions">
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4" selected>4</option>
              <option value="5">5</option>
            </select>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ (–æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –∏ —Ñ–∏–¥–±–µ–∫–∞)</h2>

      <div class="grid3">
        <div>
          <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (px)</label>
          <input type="number" id="uiFontSize" value="22" min="10" max="50">
          <div class="hint">–û–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è/–∫–≤–∏–∑–æ–≤/—Ñ–∏–¥–±–µ–∫–∞.</div>
        </div>
        <div class="pill" style="justify-content:space-between">
          <strong><input type="checkbox" id="taskNeon"> –ù–µ–æ–Ω —É –∑–∞–¥–∞–Ω–∏—è</strong>
          <span></span>
        </div>
        <div class="pill" style="justify-content:space-between">
          <strong><input type="checkbox" id="feedbackNeon"> –ù–µ–æ–Ω —É —Ñ–∏–¥–±–µ–∫–∞</strong>
          <span></span>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–ó–∞–¥–∞–Ω–∏–µ: —Ñ–æ–Ω</label>
          <input type="color" id="taskBgColor" value="#4facfe">
        </div>
        <div>
          <label>–ó–∞–¥–∞–Ω–∏–µ: —Ä–∞–º–∫–∞</label>
          <input type="color" id="taskBorderColor" value="#00f2fe">
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–ó–∞–¥–∞–Ω–∏–µ: —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
          <input type="color" id="taskTextColor" value="#ffffff">
        </div>
        <div>
          <label>–ó–∞–¥–∞–Ω–∏–µ: –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ (0‚Äì1)</label>
          <input type="number" id="taskBgOpacity" value="1" step="0.1" min="0" max="1">
          <div class="hint">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤—É–µ—Ç <b>—Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–æ–Ω</b>, –Ω–µ –Ω–∞ —Ç–µ–∫—Å—Ç.</div>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–§–∏–¥–±–µ–∫: —Ñ–æ–Ω —Ç–µ–∫—Å—Ç–∞</label>
          <input type="color" id="feedbackBgColor" value="#131316">
        </div>
        <div>
          <label>–§–∏–¥–±–µ–∫: —Ä–∞–º–∫–∞</label>
          <input type="color" id="feedbackBorderColor" value="#e67e22">
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>–§–∏–¥–±–µ–∫: —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
          <input type="color" id="feedbackTextColor" value="#ffffff">
        </div>
        <div></div>
      </div>

      <div class="divider"></div>

      <h2>üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>

      <label>iframe –¥–ª—è Genially</label>
      <div class="result">
        <textarea id="iframeOut" readonly placeholder="–ù–∞–∂–º–∏ ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù, –∏ —Ç—É—Ç –ø–æ—è–≤–∏—Ç—Å—è iframe"></textarea>
        <div class="btnRow">
          <button id="saveBtn" class="btn-mini">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="testBtn" class="btn-ghost btn-mini">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
          <button id="copyBtn" class="btn-ghost btn-mini">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
      <div class="hint">–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–æ–∂–¥–∏ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à).</div>
    </section>

    <!-- RIGHT: preview -->
    <section class="card">
      <h2>üß™ –ü—Ä–µ–≤—å—é (–∫–∞–∫ –≤ –∏–≥—Ä–µ)</h2>

      <div class="stack">

        <div class="previewBlock">
          <div class="previewTitle">
            <span>–°—á—ë—Ç—á–∏–∫</span><span style="color:var(--muted); font-weight:700">–∏–∫–æ–Ω–∫–∞ + –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
          </div>
          <div class="previewStage">
            <div class="pv-counter">
              <span class="icon" id="iconPrev"></span>
              <span id="textPrev">0 / 0</span>
            </div>
          </div>
        </div>

        <div class="previewBlock">
          <div class="previewTitle">
            <span>–û–∫–Ω–æ –∑–∞–¥–∞–Ω–∏—è</span><span id="modeBadge" style="color:var(--muted); font-weight:800">MODE</span>
          </div>
          <div class="previewStage">
            <div class="pv-card" id="taskCard">
              <div class="pv-q" id="pvQ">‚Äî</div>
              <div id="pvBody"></div>
            </div>
          </div>
          <div class="hint" id="pvHint"></div>
        </div>

        <div class="previewBlock">
          <div class="previewTitle">
            <span>–§–∏–¥–±–µ–∫</span><span style="color:var(--muted); font-weight:800" id="fbBadge">mode</span>
          </div>
          <div class="previewStage" style="text-align:center">
            <div id="pvFeedbackWrap"></div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <script>
    const $ = s => document.querySelector(s);

    const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
    const PUBLISH_KEY = "nika_read_pub_2025";
    const BASE_MAIN   = "https://nikashum93.github.io/utki/main.html";

    const LANGUAGE_OPTIONS = [
      { value: "ru", label: "–†—É—Å—Å–∫–∏–π" },
      { value: "en", label: "English" },
      { value: "es", label: "Espa√±ol" },
      { value: "de", label: "Deutsch" },
      { value: "fr", label: "Fran√ßais" },
      { value: "it", label: "Italiano" },
      { value: "zh", label: "‰∏≠Êñá" },
      { value: "ja", label: "Êó•Êú¨Ë™û" }
    ];

    // –í–ê–ñ–ù–û: ‚Äú–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ‚Äù —à—Ä–∏—Ñ—Ç—ã –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç CJK.
    // –ü–æ—ç—Ç–æ–º—É:
    // - –¥–ª—è ru/en/es/de/fr/it –º–æ–∂–Ω–æ –¥–∞—Ç—å ‚Äú–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ/—Ä—É–∫–æ–ø–∏—Å–Ω—ã–µ‚Äù
    // - –¥–ª—è zh/ja ‚Äî —Ç–æ–ª—å–∫–æ CJK-—à—Ä–∏—Ñ—Ç—ã (–∏–Ω–∞—á–µ –∫–≤–∞–¥—Ä–∞—Ç—ã).
    const FONT_MAP = {
      ru: ["Rubik","Montserrat","PT Sans","Nunito","Comfortaa","Bad Script","Neucha","Lobster"],
      en: ["Inter","Poppins","Roboto","Open Sans","Rubik","Nunito","Pacifico","Lobster Two","Mountains of Christmas","Fredericka the Great"],
      es: ["Poppins","Montserrat","Noto Sans","Open Sans","Nunito","Pacifico","Lobster Two"],
      de: ["Fira Sans","Montserrat","Noto Sans","Open Sans","Nunito","Fredericka the Great"],
      fr: ["Poppins","Montserrat","Noto Sans","Open Sans","Nunito","Pacifico"],
      it: ["Rubik","Inter","Noto Sans","Roboto","Nunito","Pacifico"],
      zh: ["Noto Sans SC","Noto Serif SC"],
      ja: ["Noto Sans JP","Noto Serif JP"]
    };

    const I18N = {
      ru:{ inputPlaceholder:'–í–ø–∏—à–∏ –æ—Ç–≤–µ—Ç...', done:'–ì–æ—Ç–æ–≤–æ' },
      en:{ inputPlaceholder:'Type the answer...', done:'Done' },
      es:{ inputPlaceholder:'Escribe la respuesta...', done:'Listo' },
      de:{ inputPlaceholder:'Antwort eingeben...', done:'Fertig' },
      fr:{ inputPlaceholder:'√âcris la r√©ponse...', done:'Termin√©' },
      it:{ inputPlaceholder:'Scrivi la risposta...', done:'Fatto' },
      ja:{ inputPlaceholder:'Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ‚Ä¶', done:'ÂÆå‰∫Ü' },
      zh:{ inputPlaceholder:'ËØ∑ËæìÂÖ•Á≠îÊ°à‚Ä¶', done:'ÂÆåÊàê' }
    };

    function t(key){
      const lang = $('#language').value || 'ru';
      const d = I18N[lang] || I18N.en;
      return d[key] || key;
    }

    function fillLanguageSelect(){
      const sel = $('#language');
      sel.innerHTML = "";
      LANGUAGE_OPTIONS.forEach(opt => {
        const o = document.createElement('option');
        o.value = opt.value;
        o.textContent = opt.label;
        sel.appendChild(o);
      });
      sel.value = 'ru';
    }

    function fillFontsForLanguage(lang){
      const sel = $('#font');
      sel.innerHTML = "";
      const list = FONT_MAP[lang] || FONT_MAP.en;
      list.forEach(f => {
        const opt = document.createElement('option');
        opt.textContent = f;
        opt.value = f;
        sel.appendChild(opt);
      });
      sel.value = list[0];
      applyGoogleFont(sel.value, lang);
    }

    function applyGoogleFont(fontName, lang){
      if(!fontName) return;
      const gf = document.getElementById('gf');
      const family = fontName.replace(/ /g, '+');
      gf.href = `https://fonts.googleapis.com/css2?family=${family}:wght@400;700;900&display=swap`;
      document.body.style.fontFamily = fontName + ', system-ui, sans-serif';
    }

    function collectConfig(){
      const lang = $('#language').value;
      const font = $('#font').value;

      const bgImage = $('#bgImage').value.trim();
      const bubbleSize = parseInt($('#bubbleSize').value,10) || 80;

      const finalFeedback = $('#finalFeedback').value.trim();
      const feedbackImage = $('#feedbackImage').value.trim();
      const feedbackEnabled = $('#feedbackEnabled').checked;
      const feedbackMode = $('#feedbackMode').value; // both/text/image

      const popSoundUrl   = $('#popSound').value.trim()   || 'https://nikashum93.github.io/utki/pop.mp3';
      const openSoundUrl  = $('#openSound').value.trim()  || 'https://nikashum93.github.io/utki/open.mp3';

      const qLines  = $('#questions').value.split('\n');
      const cLines  = $('#correctAnswers').value.split('\n');
      const wLines  = $('#wrongAnswers').value.split('\n');

      const maxLen = Math.max(qLines.length, cLines.length, wLines.length);
      const tasks = [];

      const isImageUrl = (s) => /^https?:\/\//i.test(s) && /\.(png|gif|jpe?g|webp)(\?.*)?$/i.test(s);

      for (let i=0; i<maxLen; i++){
        const q = (qLines[i] || '').trim();
        const cRaw = (cLines[i] || '').trim();
        const wRaw = (wLines[i] || '').trim();

        if (!q && !cRaw && !wRaw) continue;

        if (q && !cRaw && !wRaw && isImageUrl(q)) {
          tasks.push({ type:'image', image:q });
          continue;
        }

        const correct = cRaw ? cRaw.split('|').map(s=>s.trim()).filter(Boolean) : [];
        const wrong   = wRaw ? wRaw.split('|').map(s=>s.trim()).filter(Boolean) : [];

        tasks.push({ question: q, correct, wrong });
      }

      const uiFontSize = parseInt($('#uiFontSize').value,10) || 22;

      const taskBgColor     = $('#taskBgColor').value;
      const taskBorderColor = $('#taskBorderColor').value;
      const taskTextColor   = $('#taskTextColor').value;
      const taskBgOpacity   = parseFloat($('#taskBgOpacity').value);
      const taskNeon        = $('#taskNeon').checked;

      const feedbackBorderColor = $('#feedbackBorderColor').value;
      const feedbackTextColor   = $('#feedbackTextColor').value;
      const feedbackBgColor     = $('#feedbackBgColor').value;
      const feedbackNeon        = $('#feedbackNeon').checked;

      const orderMode = $('#orderMode').checked;
      const autoDistractors = $('#autoDistractors').checked;
      const quizUseOtherCorrect = $('#quizUseOtherCorrect')?.checked || false;
      const quizMaxOptions = parseInt($('#quizMaxOptions')?.value || '4', 10);

      return {
        language: lang,
        lang,
        font,
        bubbleSize, // –ù–û–í–û–ï
        sounds: { pop: popSoundUrl, open: openSoundUrl },
        style: {
          bgImage,
          task: {
            bgColor: taskBgColor,
            borderColor: taskBorderColor,
            textColor: taskTextColor,
            opacity: isFinite(taskBgOpacity) ? taskBgOpacity : 1,
            fontSize: uiFontSize,
            neon: taskNeon
          },
          feedback: {
            bgColor: feedbackBgColor,
            borderColor: feedbackBorderColor,
            textColor: feedbackTextColor,
            neon: feedbackNeon,
            fontSize: uiFontSize
          }
        },
        finalFeedback,
        feedbackImage,
        feedbackEnabled,
        feedbackMode, // –ù–û–í–û–ï: both/text/image
        orderMode,
        autoDistractors,
        quizUseOtherCorrect,
        quizMaxOptions,
        tasks
      };
    }

    function validate(cfg){
      if(!cfg.tasks || !cfg.tasks.length) return '–î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ.';
      // –∑–∞–ø—Ä–µ—Ç "–æ–±–∞ –ø—É—Å—Ç—ã–µ" –≤–Ω—É—Ç—Ä–∏ feedbackMode —É–∂–µ –æ–±–µ—Å–ø–µ—á–µ–Ω —Å–µ–ª–µ–∫—Ç–æ–º
      return null;
    }

    function makeIdFromFirstTask(cfg){
      const firstQ = (cfg.tasks[0]?.question || 'task').trim();
      const slug = firstQ.toLowerCase()
        .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
        .slice(0,40) || 'task';
      const d=new Date(),p=n=>String(n).padStart(2,'0');
      const stamp = `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
      return `${slug}-${stamp}`;
    }

    async function publish(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }

      const id = makeIdFromFirstTask(cfg);
      const payload = {
        id,
        mode: "json",
        folder: "data",
        content: JSON.stringify(cfg, null, 2)
      };

      try{
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-Publish-Key": PUBLISH_KEY
          },
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const t = await res.text().catch(()=>res.statusText);
          throw new Error(t || 'Server error');
        }
        const iframe = `<iframe src="${BASE_MAIN}?id=${encodeURIComponent(id)}" width="900" height="640" style="border:0;" allow="autoplay" allowfullscreen></iframe>`;
        $('#iframeOut').value = iframe;
        alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –ü–æ–¥–æ–∂–¥–∏ 30‚Äì60 —Å–µ–∫—É–Ω–¥ (–∫–µ—à).');
      }catch(e){
        alert("–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä: " + e.message);
      }
    }

    async function quickTest(){
      const cfg = collectConfig();
      const err = validate(cfg);
      if(err){ alert(err); return; }
      alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –ó–∞–¥–∞–Ω–∏–π: ' + cfg.tasks.length);
      console.log(cfg);
    }

    function copyIframe(){
      const v = $('#iframeOut').value.trim();
      if(!v){ alert('–°–Ω–∞—á–∞–ª–∞ ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.'); return; }
      navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{});
    }

    // ----- Preview -----
    function hexToRgba(hex, alpha){
      const m = String(hex||'').trim().match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);
      if(!m) return null;
      let x = m[1];
      if(x.length===3) x = x.split('').map(c=>c+c).join('');
      const r = parseInt(x.slice(0,2),16);
      const g = parseInt(x.slice(2,4),16);
      const b = parseInt(x.slice(4,6),16);
      const a = Math.max(0, Math.min(1, Number(alpha)));
      return `rgba(${r},${g},${b},${a})`;
    }

    function detectModeForLine(q, cRaw, wRaw, orderMode){
      const qv = (q||'').trim();
      const c = (cRaw||'').trim();
      const w = (wRaw||'').trim();

      if(!qv && !c && !w) return 'empty';
      if(orderMode && qv && !c && !w) return 'order';

      const correct = c ? c.split('|').map(s=>s.trim()).filter(Boolean) : [];
      const wrong   = w ? w.split('|').map(s=>s.trim()).filter(Boolean) : [];

      if(correct.length === 0) return 'text';
      if(correct.length === 1 && (wrong.length === 0)) return 'input';
      // –µ—Å–ª–∏ correct –µ—Å—Ç—å, –∞ wrong –ø—É—Å—Ç, –≤ –∏–≥—Ä–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å input –∏–ª–∏ quiz –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –ø–æ–¥–º–µ—à–∞—é—Ç—Å—è –ª–∏ distractors
      // –¥–ª—è –ø—Ä–µ–≤—å—é: –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω autoDistractors/quizUseOtherCorrect ‚Äî –ø–æ–∫–∞–∂–µ–º quiz, –∏–Ω–∞—á–µ input
      return 'quizCandidate';
    }

    function refreshPreview(){
      const cfg = collectConfig();

      // counter
      const url = cfg.style.bgImage;
      $('#iconPrev').style.backgroundImage = url ? `url(${url})` : 'none';
      $('#textPrev').textContent = '0 / ' + (cfg.tasks.length || 0);

      // take first non-empty line
      const qLines  = $('#questions').value.split('\n');
      const cLines  = $('#correctAnswers').value.split('\n');
      const wLines  = $('#wrongAnswers').value.split('\n');

      let pick = null;
      for(let i=0;i<Math.max(qLines.length,cLines.length,wLines.length);i++){
        const q=(qLines[i]||'').trim();
        const c=(cLines[i]||'').trim();
        const w=(wLines[i]||'').trim();
        if(q||c||w){ pick={q,c,w}; break; }
      }
      if(!pick) pick = {q:'',c:'',w:''};

      const mode0 = detectModeForLine(pick.q, pick.c, pick.w, cfg.orderMode);
      let mode = mode0;

      // resolve quizCandidate
      if(mode === 'quizCandidate'){
        const hasWrong = (pick.w||'').trim().length>0;
        const canAuto = cfg.autoDistractors || cfg.quizUseOtherCorrect;
        mode = (hasWrong || canAuto) ? 'quiz' : 'input';
      }

      $('#modeBadge').textContent = mode.toUpperCase();

      // task card styles
      const card = $('#taskCard');
      const bg = cfg.style.task.bgColor;
      const op = cfg.style.task.opacity;
      const rgba = hexToRgba(bg, op);
      card.style.background = rgba || bg || 'linear-gradient(135deg,#4facfe,#00f2fe)';
      card.style.borderColor = cfg.style.task.borderColor || 'transparent';
      card.style.color = cfg.style.task.textColor || '#fff';
      card.style.fontSize = (cfg.style.task.fontSize||22) + 'px';
      card.style.boxShadow = cfg.style.task.neon
        ? `0 0 18px ${cfg.style.task.borderColor || '#fff'}`
        : '0 10px 26px rgba(0,0,0,.28)';

      $('#pvQ').textContent = pick.q || '‚Äî';
      const pvBody = $('#pvBody');
      pvBody.innerHTML = '';

      const fontSize = (cfg.style.task.fontSize||22);

      if(mode === 'text'){
        const done = document.createElement('button');
        done.className = 'pv-btn';
        done.textContent = t('done');
        done.style.fontSize = fontSize + 'px';
        pvBody.appendChild(done);
        $('#pvHint').innerHTML = 'TEXT: —É—Å—Ç–Ω–æ ‚Üí –Ω–∞–∂–∏–º–∞–µ—à—å ‚ÄúDone‚Äù.';
      }

      if(mode === 'input'){
        const inp = document.createElement('input');
        inp.className = 'pv-input';
        inp.placeholder = t('inputPlaceholder');
        inp.style.fontSize = fontSize + 'px';
        pvBody.appendChild(inp);

        const done = document.createElement('button');
        done.className = 'pv-btn';
        done.textContent = t('done');
        done.style.fontSize = fontSize + 'px';
        pvBody.appendChild(done);

        $('#pvHint').innerHTML = 'INPUT: 1 correct ‚Üí –≤–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞.';
      }

      if(mode === 'quiz'){
        const box = document.createElement('div');
        box.className = 'pv-quiz';

        // –∑–∞–≥–ª—É—à–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è (–∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª–∞), –Ω–æ –≤—ã–≥–ª—è–¥—è—Ç –ø–æ —Å—Ç–∏–ª—é –∏–≥—Ä—ã
        const demo = ['Option A','Option B','Option C','Option D'].slice(0, cfg.quizMaxOptions || 4);
        demo.forEach(txt=>{
          const b=document.createElement('button');
          b.className='pv-btn';
          b.textContent = txt;
          b.style.width='100%';
          b.style.fontSize = fontSize + 'px'; // –ù–ï –º–µ–Ω—å—à–µ —Ç–µ–∫—Å—Ç–∞
          box.appendChild(b);
        });
        pvBody.appendChild(box);
        $('#pvHint').innerHTML = 'QUIZ: –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Üí –∫–Ω–æ–ø–∫–∏ (—ç—Ç–æ –¥–µ–º–æ-–∑–∞–≥–ª—É—à–∫–∏ –ø—Ä–µ–≤—å—é).';
      }

      if(mode === 'order'){
        // –∫–∞–∫ –≤ –∏–≥—Ä–µ: –±–µ–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É, —Ç–æ–ª—å–∫–æ —Å–ª–æ–≤–∞ + ‚ÄúDone‚Äù
        const line = document.createElement('div');
        line.className = 'pv-chipLine';
        line.style.fontSize = fontSize + 'px';

        const bank = document.createElement('div');
        bank.className = 'pv-chipBank';
        bank.style.fontSize = fontSize + 'px';

        const words = (pick.q || 'I like winter').split(/\s+/).filter(Boolean).slice(0,8);
        words.forEach(w=>{
          const ch=document.createElement('button');
          ch.className='pv-chip';
          ch.textContent=w;
          ch.style.fontSize = fontSize + 'px';
          bank.appendChild(ch);
        });

        pvBody.appendChild(line);
        pvBody.appendChild(bank);

        const done = document.createElement('button');
        done.className='pv-btn';
        done.textContent = t('done');
        done.style.marginTop='12px';
        done.style.fontSize = fontSize + 'px';
        pvBody.appendChild(done);

        $('#pvHint').innerHTML = 'ORDER: —Å–æ–±–∏—Ä–∞–µ—à—å –∏–∑ —Å–ª–æ–≤ ‚Üí ‚ÄúDone‚Äù.';
      }

      // feedback preview
      const wrap = $('#pvFeedbackWrap');
      wrap.innerHTML = '';
      const fbMode = cfg.feedbackMode || 'both';
      $('#fbBadge').textContent = fbMode.toUpperCase();

      const fbText = document.createElement('div');
      fbText.textContent = cfg.finalFeedback || 'üéâ Well done!';
      fbText.style.display = 'inline-block';
      fbText.style.padding = '14px 18px';
      fbText.style.borderRadius = '16px';
      fbText.style.fontWeight = '900';
      fbText.style.fontSize = (cfg.style.feedback.fontSize || cfg.style.task.fontSize || 22) + 'px';
      fbText.style.color = cfg.style.feedback.textColor || '#fff';
      fbText.style.background = cfg.style.feedback.bgColor || '#131316';
      fbText.style.border = '2px solid ' + (cfg.style.feedback.borderColor || '#e67e22');
      fbText.style.boxShadow = cfg.style.feedback.neon ? `0 0 20px ${(cfg.style.feedback.borderColor || '#fff')}` : 'none';

      const img = document.createElement('div');
      img.style.width='220px';
      img.style.height='160px';
      img.style.margin='0 auto 12px';
      img.style.borderRadius='14px';
      img.style.border='1px solid rgba(255,255,255,.12)';
      img.style.background = cfg.feedbackImage
        ? `url(${cfg.feedbackImage}) center/contain no-repeat rgba(255,255,255,.06)`
        : 'linear-gradient(135deg, rgba(255,215,0,.22), rgba(0,240,255,.14))';
      img.style.boxShadow = '0 10px 26px rgba(0,0,0,.28)';

      if(!cfg.feedbackEnabled){
        const off = document.createElement('div');
        off.textContent = '–§–∏–¥–±–µ–∫ –≤—ã–∫–ª—é—á–µ–Ω';
        off.style.color = 'rgba(255,255,255,.7)';
        off.style.fontWeight = '900';
        wrap.appendChild(off);
      } else {
        if(fbMode === 'both'){
          wrap.appendChild(img);
          wrap.appendChild(fbText);
        } else if(fbMode === 'text'){
          wrap.appendChild(fbText);
        } else if(fbMode === 'image'){
          wrap.appendChild(img);
        }
      }
    }

    // Init
    fillLanguageSelect();
    fillFontsForLanguage($('#language').value);

    $('#language').addEventListener('change', e => {
      fillFontsForLanguage(e.target.value);
      refreshPreview();
    });
    $('#font').addEventListener('change', e => {
      applyGoogleFont(e.target.value, $('#language').value);
    });

    [
      'bgImage','bubbleSize','questions','correctAnswers','wrongAnswers',
      'finalFeedback','feedbackImage','feedbackEnabled','feedbackMode',
      'taskBgColor','taskBorderColor','taskTextColor','taskBgOpacity','taskNeon',
      'feedbackBgColor','feedbackBorderColor','feedbackTextColor','feedbackNeon',
      'uiFontSize',
      'orderMode','autoDistractors','quizUseOtherCorrect','quizMaxOptions'
    ].forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener('input', refreshPreview);
      el.addEventListener('change', refreshPreview);
    });

    $('#saveBtn').addEventListener('click', publish);
    $('#testBtn').addEventListener('click', quickTest);
    $('#copyBtn').addEventListener('click', copyIframe);

    refreshPreview();
  </script>
</body>
</html>
